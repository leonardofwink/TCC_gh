---
title: "TCC"
author: "Leonardo Fernandes Wink"
date: "`r format(Sys.time(), '%d/%m/%Y')`"
output:
  bookdown::html_document2:
    theme: flatly
    highlight: haddock
    keep_md: yes
    number_sections: yes
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: no
    fig_caption: yes
    fig_width: 10
    fig_height: 6.66
    code_download: true
    code_folding: show
    widescreen: yes
    df_print: 'kable'
  pdf_document:
    toc: yes
  word_document: 
    toc: yes
    keep_md: yes
  github_document:
    html_preview: true
always_allow_html: yes
editor_options: 
  chunk_output_type: console
fig.align: center
---

```{r Rotina pra toda vez que abrir o documento, echo = FALSE}
# Abrir o GitHub Desktop
# Verificar se há pull pra ser feito
# Abrir o RStudio
```

# Brief explanation

Every boxplot means a monitoring point (Ponto de monitoramento (or PM) in portuguese). My goal here is to analyze the evolution between decades of each water quality parameter that compounds the Water Quality Index (WQI).

The river flows in the east-west direction as shown in the image below.

![](images/paste-7AD7027F.png)

The logic behind the sorting in the boxplots is because of 2 main reasons:

1.  The original monitoring point isn't easy to understand (8 digits, like `87409900`)
2.  Changing the original nomenclature to PM1, PM2 (...) makes it easier to understand that the last point has water contributions of every other point upstream.

Some features that I want to add:

-   If the parameter is x, then use x's classes (with its own classes background color plotted)

# Anotações de coisas por fazer:

-   Descobrir como colocar as estações no sentido correto montante -\> jusante nos sumários

> 87398500, 87398980, 87398900, 87398950, 87405500, 87406900, 87409900

-   ~~Aprender a segmentar o meu dataset por períodos~~
-   aprender a criar uma nova coluna com a segmentação dos períodos
-   maybe use `~facet.grid`
-   aprender a colocar a legenda dentro do gráfico
    -   reduzir o tamanho da legenda
-   ~~corrigir os valores 0 de IQA pra NA~~
-   descobrir como conseguir a equação do lm
-   ~~aprender a pivotar o sumário~~ -\> meu sumário do google docs ta batendo direitinho com o do R
-   descobrir se há outros TCCs com disponibilização de códigos
-   ~~`Namon` tá com com casa decimal `","` e `ptot` tá com `"."`~~
-   correlação forte entre condutividade e Namon/Ptot/DBO

| 1990-2000 | 2000-2010 | 2010-2020 |
|:---------:|:---------:|:---------:|
| 1990-2000 | 2000-2010 | 2010-2020 |

# Pacotes necessários

## acessar os pacotes

```{r cronometrando quanto tempo cada chunk leva, setup, include=FALSE, echo=FALSE}
R_LIBS_SITE="E:\\Documents\\R\\R-4.2.2\\library"

knitr::knit_hooks$set(time_it = local({
   now <- NULL
   function(before, options) {
      if (before) {
         # record the current time before each chunk
         now <<- Sys.time()
      } else {
         # calculate the time difference after a chunk
         res <- difftime(Sys.time(), now)
         # return a character string to show the time
         paste("Tempo para esse code chunk ser rodado:", round(res, digits = 2), "s")
      }
   }
}))

knitr::opts_chunk$set(time_it = TRUE)
```

```{r Acessar os pacotes, message = FALSE, warning = TRUE}
pacman::p_load(
  # ETL/data wrangling
  readr, readxl, janitor,
  tidyverse,
  dplyr, 
  skimr, 
  # pillar, 
  # see,
  #modelsummary, 
  # report,
  # Data Viz
  rmarkdown, 
  knitr, 
  ## Gráficos
  ggplot2,
  GGally, 
  ggtext, 
  ggbeeswarm, 
  gridExtra,
  cowplot,
  ## Tabelas
  kableExtra, 
  gtsummary,
  formattable
  )
# pacman::p_load(tibbletime)
# cite_packages()
```

### referenciando os pacotes

```{r referenciando os pacotes}
version$version.string
# citation(package = "tidyverse")
```

## importando a planilha

```{r Importando a planilha, echo = FALSE, message = TRUE, warning = FALSE}
plan_wide_19902020 <- read_delim("https://raw.githubusercontent.com/leonardofwink/TCC_gh/main/plan_wide_19902020.tsv",
                                 delim = "\t", 
                                 escape_double = FALSE,
                                 col_types = cols(
                                   Alcalinidade = col_double(),
                                   CODIGO = col_character(), 
                                   COORD_GEO_LAT_GRAU = col_double(),
                                   COORD_GEO_LONG_GRAU = col_double(),
                                   DATA_COLETA = col_date(format = "%d/%m/%Y"),
                                   Nitrato = col_double(), 
                                   Nitrito = col_double(),
                                   SDT = col_double(), 
                                   SST = col_double(),
                                   `Vazao` = col_double(), 
                                   `Vazao rio` = col_double()
                                 ),
                                 locale = locale(
                                   date_names = "pt", 
                                   decimal_mark = ",",
                                   grouping_mark = ""
                                 ),
                                 trim_ws = TRUE
) %>% 
  janitor::clean_names() %>% 
  rename(
    pH = p_h,
    iqa_pH = iqa_p_h,
    iqa_pH_2 = iqa_p_h_2
  ) %>% 
  mutate(
    ponto_monitoramento = case_when(
      codigo == "87398500" ~ "PM1",
      codigo == "87398980" ~ "PM2",
      codigo == "87398900" ~ "PM3",
      codigo == "87398950" ~ "PM4",
      codigo == "87405500" ~ "PM5",
      codigo == "87406900" ~ "PM6",
      codigo == "87409900" ~ "PM7"
    )
  ) %>% 
  select(codigo, ponto_monitoramento, everything()) %>% #reordenando colunas
  arrange(data_coleta, ponto_monitoramento)
# teste <- plan_wide_19902020 %>%
#   dplyr::filter(data_coleta >= as.POSIXct("2010-01-01")) #this works
```

```{r Visualização da planilha importada, echo = FALSE}
paged_table(plan_wide_19902020,
            options = list(rows.print = 15,
                           cols.print = 10))
```

# data wrangling

Como há dados faltantes, no cálculo entre o produto das colunas, o R acaba interpretando como se fosse zero, mas na verdade é `NA`.

```{r data wrangling}
plan_wide_19902020 <- plan_wide_19902020 %>% 
   mutate(iqa = ifelse(iqa == 0, NA, iqa))

parametros_IQA <- plan_wide_19902020 %>%
  select(
    codigo,
    ponto_monitoramento,
    pH,
    oxigenio_dissolvido,
    dbo,
    fosforo_total,
    escherichia_coli,
    nitrogenio_amoniacal,
    nitrogenio_kjeldahl,
    nitrogenio_total,
    turbidez,
    temperatura_agua,
    solidos_totais,
    condutividade,
    ano_coleta
  )

write.csv(parametros_IQA,
          "./parametros_IQA.csv",
          row.names = FALSE)
```

```{r futuro calculo de IQA, include = FALSE}
plan_wide_19902020 %>% 
  select(starts_with("iqa_")) %>% 
  mutate(
    teste_iqa_calc = prod() #queria tentar gerar o produtório entre as colunas que já possuem o IQA^2
  )
```

```{r Códigos Git, echo = FALSE, include=FALSE}
# cd myrepo
# ls
# head README.md
# git status
# git add README.md
# git commit -m "A commit from my local computer"
# 
# cd .. # voltar pro diretório acima
# rm -rf myrepo/ #remover/apagar a pasta myrepo
```

```{r Aprendendo Git, echo = FALSE, include=FALSE}
# slides da bia que ajudam mt
# https://beatrizmilz.github.io/slidesR/git_rstudio/11-2021-ENCE.html#20
# aprendendo a sincronizar usando esse guia -> 
# https://happygitwithr-com.translate.goog/push-pull-github.html?_x_tr_sl=auto&_x_tr_tl=pt&_x_tr_hl=pt-BR
# library(usethis)
# usethis::create_github_token() criar um código pra acesso e sincronização between R e github

# gitcreds::gitcreds_set() 
# 
# use_git_config(user.name = "leonardofwink",
#                user.email = "leonardofwink@gmail.com")
# usethis::gh_token_help()

# Como mostrar os dados de um arquivo via Git/GitHub
# git clone https://github.com/leonardofwink/myrepo.git
# cd myrepo #acessa a pasta myrepo
# ls #lista os arquivos da pasta 
# head README.md #mostra as primeiras observações do arquivo

# Como mostrar os dados de um arquivo via R
# head(C:/Users/Léo/myrepo/README.md)

# Adicionar uma linha ao README.md e verificar se o Git percebe a mudança
# echo "A line I wrote on my local computer" >> README.md
# git status
## C:\Users\Léo\myrepo>git status
## On branch main
## Your branch is up to date with 'origin/main'.
## 
## Changes not staged for commit:
##   (use "git add <file>..." to update what will be committed)
##   (use "git restore <file>..." to discard changes in working directory)
##         **modified:   README.md**
## 
## no changes added to commit (use "git add" and/or "git commit -a")
```

# setting theme

```{r setting theme}
theme_grafs <- function(bg = "white", 
                        coloracao_letra = "black"){
  theme(
    plot.title = 
      element_text(
        hjust = 0.5,
        color = coloracao_letra,
        size = 19),
    
    axis.title.x = 
      # element_text(
      # color = coloracao_letra,
      # size = 15,
      # angle = 0,),
      element_blank(),
    axis.title.y = element_text(
      color = coloracao_letra,
      size = 15,
      angle = 90),
    
    axis.text.x = element_text(
      color = coloracao_letra,
      size = 17),
    axis.text.y = element_text(
      color = coloracao_letra,
      size = 17,
      angle = 0),
    
    strip.background = element_rect(fill = bg,
                                    linetype = 1,
                                    size = 0.5,
                                    color = "black"),
    strip.text = element_text(size = 17),
    panel.background = element_rect(fill = bg),
    plot.background = element_rect(fill = bg),
    plot.margin = margin(l = 5, r = 10,
                         b = 5, t = 5)
  )
}
```

# setting different timescales

```{r setting periodos, echo = TRUE}
plan_wide_19902020 <- plan_wide_19902020 %>% 
  mutate(
    periodo = if_else(
      ano_coleta <= 2000, 
      "1990-2000",
      if_else(
        ano_coleta <= 2010,
        "2000-2010",
        "2010-2020"
      )
    )
  )
```

# setting sumaries

```{r Sumários, echo = FALSE}
sumario <- function(dados = plan_wide_19902020, parametro = "") {
  dados %>% 
    # filter(ano_coleta>"1990" &
    #          ano_coleta<="2000") %>%
    group_by(ponto_monitoramento) %>%
    summarize(
      min =
        min(parametro,
            na.rm = TRUE),
      p05 = 
        quantile(parametro, 0.05,
                 na.rm = TRUE),
      p20 =
        quantile(parametro, 0.20,
                 na.rm = TRUE),
      median =
        median(parametro,
               na.rm = TRUE),
      mean =
        mean(parametro,
             na.rm= TRUE),
      p80 =
        quantile(parametro, 0.80,
                 na.rm = TRUE),
      p95 =
        quantile(parametro, 0.95,
                 na.rm = TRUE),
      max =
        max(parametro,
            na.rm = TRUE)
      )
}
```

# Funções

## criando função para gerar boxplots com percentil 20 e 80

```{r funcao percentil 80}
f <- function(x) {
  r <- quantile(x, probs = c(0.05, 0.20, 0.50, 0.80, 0.95))
  names(r) <- c("ymin", "lower", "middle", "upper", "ymax")
  return(r)
}
```

## Oxigênio Dissolvido

```{r gerando function graf od, echo = TRUE}
boxplot_od <- function(dados = plan_wide_19902020, eixo_x = codigo, eixo_y = oxigenio_dissolvido, titulo = "Oxigênio Dissolvido"){
  ggplot2::ggplot(
    data = dados,
    aes(
      x = {{eixo_x}},
      y = {{eixo_y}}
    )
  )+
    annotate("rect",
             xmin = -Inf, xmax = Inf,
             ymin = -Inf, ymax = 2,
             alpha = 1,
             fill = "#ac5079")+ #>pior classe
    annotate("rect",
             xmin = -Inf, xmax = Inf,
             ymin = 2, ymax = 4,
             alpha = 1,
             fill = "#eb5661")+ #classe 4
    annotate("rect",
             xmin = -Inf, xmax = Inf,
             ymin = 4, ymax = 5,
             alpha = 1,
             fill = "#fcf7ab")+ #classe 3
    annotate("rect",
             xmin = -Inf, xmax = Inf,
             ymin = 5, ymax = 6,
             alpha = 1,
             fill = "#70c18c")+ #classe 2
    annotate("rect",
             xmin = -Inf, xmax = Inf,
             ymin= 6, ymax = Inf,
             alpha = 1,
             fill = "#8dcdeb")+ #classe 1
    stat_summary(
      fun.data = f,
      geom = 'errorbar',
      width = 0.3,
      position = position_dodge(width = 0.65),
    )+
    stat_summary(
      fun.data = f,
      geom = "boxplot",
      width = 0.7,
      fill = '#F8F8FF',
      color = "black",
      outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
    )+
    # facet_wrap(~periodo)+
    labs(
      title = titulo,
      x= NULL,
      y="mg/L"
    )+
    ggbeeswarm::geom_quasirandom(
      size = 1.2,
      alpha = .25,
      width = .07,
    )+
    scale_y_continuous(
      expand = expansion(mult = c(0,0)),
      n.breaks = 11,
      limits = c(-0.3,21)
    )+
    scale_x_discrete(limits = c("87398500",
                                "87398980",
                                "87398900",
                                "87398950",
                                "87405500",
                                "87406900",
                                "87409900"),
                     labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
    )+
    geom_smooth(
      method = "lm",
      se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
      aes(group = 1),
      alpha = .5,
      na.rm = TRUE,
      size = 1
    )+
    theme_grafs()
}
```

## DBO

```{r gerando function graf dbo, echo = TRUE}
boxplot_dbo <- function(dados = plan_wide_19902020, eixo_x = codigo, eixo_y = dbo, titulo = "Demanda Bioquímica de Oxigênio"){
  ggplot2::ggplot(
    data = dados,
    aes(
      x = {{eixo_x}},
      y = {{eixo_y}}
    )
  )+
    annotate("rect",
             xmin=-Inf, xmax=Inf,
             ymin=10, ymax=Inf,
             alpha=1,
             fill="#ac5079")+ #>pior classe
    annotate("rect",
             xmin=-Inf, xmax=Inf,
             ymin=5, ymax=10,
             alpha=1,
             fill="#fcf7ab")+ #classe 3
    annotate("rect",
             xmin=-Inf, xmax=Inf,
             ymin=3, ymax=5,
             alpha=1,
             fill="#70c18c")+ #classe 2
    annotate("rect",
             xmin=-Inf, xmax=Inf,
             ymin=0, ymax=3,
             alpha=1,
             fill="#8dcdeb")+ #classe 1
    stat_summary(
      fun.data = f,
      geom = 'errorbar',
      width = 0.3,
      position = position_dodge(width = 0.65),
    )+
    stat_summary(
      fun.data = f,
      geom = "boxplot",
      width = 0.7,
      fill = '#F8F8FF',
      color = "black",
      outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
    )+
    # facet_wrap(~periodo)+
    labs(title = titulo,
         x="Estação",
         y="mg/L",
         caption = "Leonardo Fernandes Wink"
    )+
    ggbeeswarm::geom_quasirandom(
      size = 1.2,
      alpha = .25,
      width = .07,
    )+
    scale_x_discrete(limits = c("87398500", 
                                "87398980", 
                                "87398900", 
                                "87398950", 
                                "87405500", 
                                "87406900", 
                                "87409900"),
                     labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
    )+
    scale_y_continuous(expand = expansion(mult = c(0.03,0.03)),
                       n.breaks = 8,
                       limits = c(1,100),
                       trans = "log10")+
    geom_smooth(method = "lm",
                se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
                aes(group=1),
                alpha=.5,
                na.rm = TRUE,
                size = 1)+
    theme_grafs()
}
```

## Ptot

```{r gerando function graf ptot, echo = TRUE}
boxplot_ptot <- function(dados = plan_wide_19902020, eixo_x = codigo, eixo_y = fosforo_total, titulo = "Fósforo total"){
  ggplot2::ggplot(
    data = dados,
    aes(
      x = {{eixo_x}},
      y = {{eixo_y}}
    )
  )+
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=0.15,
            ymax=Inf,
            alpha=1,
            fill="#ac5079")+ #>pior classe
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=0.1,
            ymax=0.15,
            alpha=1,
            fill="#fcf7ab")+ #classe 3
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=0,
            ymax=0.1,
            alpha=1,
            fill="#8dcdeb")+ #classe 1
  stat_summary(
     fun.data = f,
     geom = 'errorbar',
     width = 0.3,
     position = position_dodge(width = 0.65),
   )+
   stat_summary(
     fun.data = f,
     geom = "boxplot",
     width = 0.7,
     fill = '#F8F8FF',
     color = "black",
     outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
   )+
    labs(title = titulo,
         x="Estação",
         y="mg/L")+
   scale_y_continuous(expand = expansion(mult = c(0.03,0.03)),
                      n.breaks = 8,
                      limits = c(min(plan_wide_19902020$fosforo_total, na.rm = TRUE),
                                 max(plan_wide_19902020$fosforo_total), na.rm = TRUE),
                      trans = "log10",
                      labels = scales::number_format(accuracy = .001,
                                                     decimal.mark = ",",
                                                     big.mark = " ")
                      )+
    ggbeeswarm::geom_quasirandom(
       size = 1.2,
       alpha = .25,
       width = .07,
    )+
    scale_x_discrete(limits = c("87398500", 
                                "87398980", 
                                "87398900", 
                                "87398950", 
                                "87405500", 
                                "87406900", 
                                "87409900"),
                     labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
    )+
    geom_smooth(method = "lm",
                se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
                aes(group=1),
                alpha=.5,
                na.rm = TRUE,
                size = 1)+
    theme_grafs()
}
```

## E coli

```{r funcao-graf-ecoli, echo = TRUE}
boxplot_ecoli <- function(dados = plan_wide_19902020, eixo_x = codigo, eixo_y = escherichia_coli, titulo = "*Escherichia coli*"){
  ggplot2::ggplot(
    data = dados,
    aes(
      x = {{eixo_x}},
      y = {{eixo_y}}
    )
  )+
   annotate("rect",
            xmin=-Inf, xmax=Inf,
            ymin=3200, ymax=Inf,
            alpha=1,
            fill="#ac5079")+ #>pior classe
   annotate("rect",
            xmin=-Inf, xmax=Inf,
            ymin=800, ymax=3200,
            alpha=1,
            fill="#fcf7ab")+ #classe 3
   annotate("rect",
            xmin=-Inf, xmax=Inf,
            ymin=160, ymax=800,
            alpha=1,
            fill="#70c18c")+ #classe 2
   annotate("rect",
            xmin=-Inf, xmax=Inf,
            ymin=0, ymax=160,
            alpha=1,
            fill="#8dcdeb")+ #classe 1
   stat_summary(
     fun.data = f,
     geom = 'errorbar',
     width = 0.3,
     position = position_dodge(width = 0.65),
   )+
   stat_summary(
     fun.data = f,
     geom = "boxplot",
     width = 0.7,
     fill = '#F8F8FF',
     color = "black",
     outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
   )+
   # facet_wrap(~periodo)+
   labs(title = titulo,
        x="Estação",
        y="NMP/100mL")+
   scale_y_continuous(expand = expansion(mult = c(0.01, 0.01)),
                      # n.breaks = 9,
                      n.breaks = 6,
                      limits = c(min(plan_wide_19902020$escherichia_coli, na.rm = TRUE),
                                 max(plan_wide_19902020$escherichia_coli, na.rm = TRUE)),
                      trans = "log10",
                      labels = scales::number_format(accuracy = 1,
                                                     decimal.mark = ",",
                                                     big.mark = " "))+
   ggbeeswarm::geom_quasirandom(
     size = 1.2,
     alpha = .25,
     width = .07,
   )+
   scale_x_discrete(limits = c("87398500", 
                               "87398980", 
                               "87398900", 
                               "87398950", 
                               "87405500", 
                               "87406900", 
                               "87409900"),
                    labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
   )+
   geom_smooth(method = "lm",
               se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
               aes(group=1),
               alpha=.5,
               na.rm = TRUE,
               size = 1)+
   theme_grafs()+
    theme(
        axis.text.y = element_text(
          angle = 90, 
          # size=15,
          # face=2
        ),
        plot.title = 
          element_markdown(
            hjust = 0.5,
            color = "black",
            size = 19)
    )
}
```

## Nitrogênio Amoniacal

```{r gerando function graf namon, echo = TRUE}
boxplot_namon <- function(dados = plan_wide_19902020, eixo_x = codigo, eixo_y = nitrogenio_amoniacal, titulo = "Nitrogênio Amoniacal"){
  ggplot2::ggplot(
    data = dados,
    aes(
      x = {{eixo_x}},
      y = {{eixo_y}}
    )
  )+
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=13.3,
            ymax=Inf,
            alpha=1,
            fill="#ac5079")+ #>pior classe
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=3.7,
            ymax=13.3,
            alpha=1,
            fill="#fcf7ab")+ #classe 3
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=0,
            ymax=3.7,
            alpha=1,
            fill="#8dcdeb")+ #classe 1
   stat_summary(
     fun.data = f,
     geom = 'errorbar',
     width = 0.3,
     position = position_dodge(width = 0.65),
   )+
   stat_summary(
     fun.data = f,
     geom = "boxplot",
     width = 0.7,
     fill = '#F8F8FF',
     color = "black",
     outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
   )+
   # facet_wrap(~periodo)+
   labs(title = titulo,
        x="Estação",
        y="mg/L")+
   scale_y_continuous(expand = expansion(mult = c(0.01, 0.05)),
                      n.breaks = 9,
                      limits = c(min(plan_wide_19902020$nitrogenio_amoniacal, na.rm = TRUE),
                                 max(plan_wide_19902020$nitrogenio_amoniacal, na.rm = TRUE)),
                      trans = "log10",
                      labels = scales::number_format(accuracy = .001,
                                                     decimal.mark = ",",
                                                     big.mark = " "))+
   ggbeeswarm::geom_quasirandom(
     size = 1.2,
     alpha = .25,
     width = .07,
   )+
   scale_x_discrete(limits = c("87398500", 
                               "87398980", 
                               "87398900", 
                               "87398950", 
                               "87405500", 
                               "87406900", 
                               "87409900"),
                    labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
   )+
   geom_smooth(method = "lm",
               se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
               aes(group=1),
               alpha=.5,
               na.rm = TRUE,
               size = 1)+
   theme_grafs()
}
```

## Turbidez

```{r gerando function graf turb, echo = TRUE}
boxplot_turb <- function(dados = plan_wide_19902020, eixo_x = codigo, eixo_y = turbidez, titulo = "Turbidez"){
  ggplot2::ggplot(
    data = dados,
    aes(
      x = {{eixo_x}},
      y = {{eixo_y}}
    )
  )+
    annotate("rect",
             xmin=-Inf, xmax=Inf,
             ymin=100, ymax=Inf,
             alpha=1,
             fill="#ac5079")+ #>pior classe
    annotate("rect",
             xmin=-Inf, xmax=Inf,
            ymin=40, ymax=100,
            alpha=1,
            fill="#fcf7ab")+ #classe 3
   annotate("rect",
            xmin=-Inf, xmax=Inf,
            ymin=0, ymax=40,
            alpha=1,
            fill="#8dcdeb")+ #classe 1
   stat_summary(
     fun.data = f,
     geom = 'errorbar',
     width = 0.3,
     position = position_dodge(width = 0.65),
   )+
   stat_summary(
     fun.data = f,
     geom = "boxplot",
     width = 0.7,
     fill = '#F8F8FF',
     color = "black",
     outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
   )+
   labs(title = titulo,
        x="Estação",
        y="UNT")+
   scale_y_continuous(expand = expansion(mult = c(0.05, 0.05)),
                      n.breaks = 8,
                      limits = c(
                        # 1,
                        min(plan_wide_19902020$turbidez, na.rm = TRUE),
                        # 500
                        max(plan_wide_19902020$turbidez, na.rm = TRUE)
                      ),
                      trans = "log10",
                      labels = scales::number_format(accuracy = 1,
                                                     decimal.mark = ",",
                                                     big.mark = " "))+
    ggbeeswarm::geom_quasirandom(
     size = 1.2,
     alpha = .25,
     width = .07,
   )+
   scale_x_discrete(limits = c("87398500", 
                               "87398980", 
                               "87398900", 
                               "87398950", 
                               "87405500", 
                               "87406900", 
                               "87409900"),
                    labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
   )+
   geom_smooth(method = "lm",
               se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
               aes(group=1),
               alpha=.5,
               na.rm = TRUE,
               size = 1)+
    theme_grafs()
}

```

## pH

```{r gerando function graf pH, echo = TRUE}
boxplot_pH <- function(dados = plan_wide_19902020, eixo_x = codigo, eixo_y = pH, titulo = "pH"){
  ggplot2::ggplot(
    data = dados,
    aes(
      x = {{eixo_x}},
      y = {{eixo_y}}
    )
  )+
    annotate("rect",
            xmin = -Inf, xmax = Inf,
            ymin = -Inf, ymax = 6,
            alpha = 1,
            fill="#eb5661")+ #classe 4
   annotate("rect",
            xmin = -Inf, xmax = Inf,
            ymin = 9, ymax = Inf,
            alpha = 1,
            fill="#eb5661")+ #classe 4
   annotate("rect",
            xmin = -Inf, xmax = Inf,
            ymin = 6, ymax = 9,
            alpha = 1,
            fill="#8dcdeb")+ #classe 1
    stat_summary(
      fun.data = f,
      geom = 'errorbar',
      width = 0.3,
      position = position_dodge(width = 0.65),
    )+
    stat_summary(
      fun.data = f,
      geom = "boxplot",
      width = 0.7,
      fill = '#F8F8FF',
      color = "black",
      outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
    )+
    labs(
      title = titulo,
      x= NULL,
      y="mg/L"
    )+
    ggbeeswarm::geom_quasirandom(
      size = 1.2,
      alpha = .25,
      width = .07,
    )+
    scale_y_continuous(expand = expansion(mult = c(0.01, 0.01)),
                      n.breaks = 8,
                      limits = c(4,11),
                      labels = scales::number_format(accuracy = 1,
                                                     decimal.mark = ",",
                                                     big.mark = " "))+
    scale_x_discrete(limits = c("87398500",
                                "87398980",
                                "87398900",
                                "87398950",
                                "87405500",
                                "87406900",
                                "87409900"),
                     labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
    )+
    geom_smooth(
      method = "lm",
      se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
      aes(group = 1),
      alpha = .5,
      na.rm = TRUE,
      size = 1
    )+
    theme_grafs()
}
```

## Sólidos Totais

```{r gerando function graf SolTot, echo = TRUE}
boxplot_solidos_totais <- function(dados = plan_wide_19902020, eixo_x = codigo, eixo_y = solidos_totais, titulo = "Sólidos totais"){
  ggplot2::ggplot(
    data = dados,
    aes(
      x = {{eixo_x}},
      y = {{eixo_y}}
    )
  )+
   annotate("rect",
            xmin = -Inf, xmax = Inf,
            ymin = 500, ymax = Inf,
            alpha = 1,
            fill = "#ac5079")+ #>pior classe
   annotate("rect",
            xmin = -Inf, xmax = Inf,
            ymin = 0, ymax = 500,
            alpha = 1,
            fill = "#8dcdeb")+ #classe 1
   stat_summary(
     fun.data = f,
     geom = 'errorbar',
     width = 0.3,
     position = position_dodge(width = 0.65),
   )+
   stat_summary(
     fun.data = f,
     geom = "boxplot",
     width = 0.7,
     fill = '#F8F8FF',
     color = "black",
     outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
   )+
   labs(title = titulo,
        x= NULL,
        y="")+
   scale_y_continuous(expand = expansion(mult = c(0.01, 0.05)),
                      n.breaks = 8,
                      limits = c(min(plan_wide_19902020$solidos_totais, na.rm = TRUE),
                                 max(plan_wide_19902020$solidos_totais, na.rm = TRUE)),
                      labels = scales::number_format(accuracy = 1,
                                                     decimal.mark = ",",
                                                     big.mark = " "),
                      trans = "log10")+
   ggbeeswarm::geom_quasirandom(
     size = 1.2,
     alpha = .25,
     width = .07,
   )+
   scale_x_discrete(limits = c("87398500", 
                               "87398980", 
                               "87398900", 
                               "87398950", 
                               "87405500", 
                               "87406900", 
                               "87409900"),
                    labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
   )+
   geom_smooth(method = "lm",
               se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
               aes(group=1),
               alpha=.5,
               na.rm = TRUE,
               size = 1)+
   theme_grafs()
}
```

## Condutividade

```{r gerando function graf condutividade-eletrica, echo = TRUE}
boxplot_cond_elet <- function(dados = plan_wide_19902020, eixo_x = codigo, eixo_y = condutividade, titulo = "Condutividade elétrica"){
  ggplot2::ggplot(
    data = dados,
    aes(
      x = {{eixo_x}},
      y = {{eixo_y}}
    )
  )+
   annotate("rect",
            xmin = -Inf, xmax = Inf,
            ymin = 500, ymax = Inf,
            alpha = 1,
            fill="#eb5661")+ #classe 4
   annotate("rect",
            xmin = -Inf, xmax = Inf,
            ymin = 0, ymax = 500,
            alpha = 1,
            fill="#8dcdeb")+ #classe 1
   stat_summary(
     fun.data = f,
     geom = 'errorbar',
     width = 0.3,
     position = position_dodge(width = 0.65),
   )+
   stat_summary(
     fun.data = f,
     geom = "boxplot",
     width = 0.7,
     fill = '#F8F8FF',
     color = "black",
     outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
   )+
      labs(title = titulo,
        x="Estação",
        y="µmhos/cm")+
   scale_y_continuous(expand = expansion(mult = c(0.01, 0.05)),
                      n.breaks = 8,
                      limits = c(
                        # min(plan_wide_19902020$condutividade, na.rm = TRUE),
                        5,
                        1000
                        # max(plan_wide_19902020$condutividade, na.rm = TRUE)
                      ),
                      labels = scales::number_format(accuracy = 1,
                                                     decimal.mark = ",",
                                                     big.mark = " "),
                      trans = "log10")+
    ggbeeswarm::geom_quasirandom(
     size = 1.2,
     alpha = .25,
     width = .07,
   )+
   scale_x_discrete(limits = c("87398500", 
                               "87398980", 
                               "87398900", 
                               "87398950", 
                               "87405500", 
                               "87406900", 
                               "87409900"),
                    labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
   )+
   geom_smooth(method = "lm",
               se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
               aes(group=1),
               alpha=.5,
               na.rm = TRUE,
               size = 1)+
   theme_grafs()
}
```

# Parâmetros físico-químicos

### Oxigênio Dissolvido

```{r Gráfico OD facetted, echo = TRUE, warning=FALSE, message = FALSE, fig.cap="Oxigênio Dissolvido no período 1990-2020"}
(od <- plan_wide_19902020 %>% 
   boxplot_od(
     titulo = "Oxigênio Dissolvido no período 1990-2020",
   )+
   facet_wrap(~periodo)
)
```

```{r Gráfico OD periodo 1, echo = FALSE, warning=FALSE, message = FALSE, fig.cap="Oxigênio Dissolvido no período 1990-2000"}
(od_p1 <- plan_wide_19902020 %>% 
   filter(ano_coleta > "1990" &
            ano_coleta <= "2000") %>% 
   boxplot_od(
     titulo = "Oxigênio Dissolvido no período 1990-2000"
   )
)
```

```{r Gráfico OD periodo 2, echo = FALSE, warning=FALSE, message = FALSE}
(od_p2 <- plan_wide_19902020 %>% 
   filter(ano_coleta > "2000" &
            ano_coleta <= "2010") %>% 
   boxplot_od(
     titulo = "Oxigênio Dissolvido no período 2000-2010"
   )
)
```

```{r Gráfico OD periodo 3, echo = FALSE, warning=FALSE, message = FALSE}
(od_p3 <- plan_wide_19902020 %>% 
   filter(ano_coleta > "2010" &
            ano_coleta <= "2020") %>% 
   boxplot_od(
     titulo = "Oxigênio Dissolvido no período 2010-2020"
   )
)
```

```{r Salvando OD, warning=FALSE, message = FALSE,}
ggsave("od.png",
       units = c("px"),
       width = 4500,
       height = 2993,
       plot = od,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("od_p1.png",
       plot = od_p1,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("od_p2.png",
       plot = od_p2,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("od_p3.png",
       plot = od_p3,
       path = "./graficos",
       dpi = 300,
       type = "cairo")
```

```{r Gráfico IQA OD periodo1, echo = FALSE, message=FALSE, warning=FALSE}
(iqaod_p1 <-ggplot(plan_wide_19902020 %>% 
                      filter(ano_coleta > "1990" &
                                ano_coleta <= "2000"),
                   aes(codigo,
                       iqa_od, na.rm = TRUE))+
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=-Inf,
             ymax=19,
             alpha=1,
             fill="#ac5079")+ #>pior classe
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=19,
             ymax=36,
             alpha=1,
             fill="#eb5661")+ #classe 4
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=36,
             ymax=51,
             alpha=1,
             fill="#fcf7ab")+ #classe 3
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=51,
             ymax=79,
             alpha=1,
             fill="#70c18c")+ #classe 2
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=79,
             ymax=Inf,
             alpha=1,
             fill="#8dcdeb")+ #classe 1
   stat_summary(
     fun.data = f,
     geom = 'errorbar',
     width = 0.3,
     position = position_dodge(width = 0.65),
   )+
   stat_summary(
     fun.data = f,
     geom = "boxplot",
     width = 0.7,
     fill = '#F8F8FF',
     color = "black",
     outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
   )+
   labs(title = "Variação do IQA para o parâmetro Oxigênio Dissolvido 1990-2000",
        x="Estação",
         y="")+
    ggbeeswarm::geom_quasirandom(
       size = 1.2,
       alpha = .25,
       width = .07,
    )+
    scale_x_discrete(limits = c("87398500", 
                                "87398980", 
                                "87398900", 
                                "87398950", 
                                "87405500", 
                                "87406900", 
                                "87409900"),
                     labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
    )+
    scale_y_continuous(expand = expansion(mult = c(0,0)),
                       n.breaks = 6,
                       limits = c(-1,101))+
    geom_smooth(
       method = "lm",
       se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
       aes(group=1),
       alpha=.5,
       na.rm = TRUE,
       linewidth = 1
    )+
    theme_grafs()
)
```

```{r Gráfico IQA OD periodo2, echo = FALSE, warning= FALSE, message = FALSE}
(iqaod_p2 <-ggplot(plan_wide_19902020 %>% 
                      filter(ano_coleta > "2000" &
                                ano_coleta <= "2010"),
                   aes(codigo,
                       iqa_od, na.rm = TRUE))+
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=-Inf,
             ymax=19,
             alpha=1,
             fill="#ac5079")+ #>pior classe
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=19,
             ymax=36,
             alpha=1,
             fill="#eb5661")+ #classe 4
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=36,
             ymax=51,
             alpha=1,
             fill="#fcf7ab")+ #classe 3
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=51,
             ymax=79,
             alpha=1,
             fill="#70c18c")+ #classe 2
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=79,
             ymax=Inf,
             alpha=1,
             fill="#8dcdeb")+ #classe 1
    stat_boxplot(geom = 'errorbar',
                 width=0.3,
                 position = position_dodge(width = 0.65),
                 na.rm = TRUE)+
    geom_boxplot(fill='#F8F8FF',
                 color="black",
                 outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
                 width= 0.7,
                 na.rm = TRUE)+
    labs(title = "Variação do IQA para o parâmetro Oxigênio Dissolvido 2000-2010",
         x="Estação",
         y="")+
    ggbeeswarm::geom_quasirandom(
       size = 1.2,
       alpha = .25,
       width = .07,
    )+
    scale_y_continuous(expand = expansion(mult = c(0,0)),
                       n.breaks = 6,
                       limits = c(-1,101))+
    scale_x_discrete(limits = c("87398500", 
                                "87398980", 
                                "87398900", 
                                "87398950", 
                                "87405500", 
                                "87406900", 
                                "87409900"),
                     labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
    )+
    geom_smooth(
       method = "lm",
       se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
       aes(group=1),
       alpha=.5,
       na.rm = TRUE,
       linewidth = 1
    )+
    theme_grafs()
)

```

```{r Gráfico IQA OD periodo3, echo = FALSE, warning=FALSE, message = FALSE}
(iqaod_p3 <-ggplot(plan_wide_19902020 %>% 
                      filter(ano_coleta > "2010" &
                                ano_coleta <= "2020"),
                   aes(codigo,
                       iqa_od, na.rm = TRUE))+
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=-Inf,
             ymax=19,
             alpha=1,
             fill="#ac5079")+ #>pior classe
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=19,
             ymax=36,
             alpha=1,
             fill="#eb5661")+ #classe 4
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=36,
             ymax=51,
             alpha=1,
             fill="#fcf7ab")+ #classe 3
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=51,
             ymax=79,
             alpha=1,
             fill="#70c18c")+ #classe 2
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=79,
             ymax=Inf,
             alpha=1,
             fill="#8dcdeb")+ #classe 1
    stat_boxplot(geom = 'errorbar',
                 width=0.3,
                 position = position_dodge(width = 0.65),
                 na.rm = TRUE)+
    geom_boxplot(fill='#F8F8FF',
                 color="black",
                 outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
                 width= 0.7,
                 na.rm = TRUE)+
    labs(title = "Variação do IQA para o parâmetro Oxigênio Dissolvido 2010-2020",
         x="Estação",
         y="")+
    ggbeeswarm::geom_quasirandom(
       size = 1.2,
       alpha = .25,
       width = .07,
    )+
    scale_y_continuous(expand = expansion(mult = c(0,0)),
                       n.breaks = 6,
                       limits = c(-1,101))+
    scale_x_discrete(limits = c("87398500", 
                                "87398980", 
                                "87398900", 
                                "87398950", 
                                "87405500", 
                                "87406900", 
                                "87409900"),
                     labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
    )+
    geom_smooth(
       method = "lm",
       se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
       aes(group=1),
       alpha=.5,
       na.rm = TRUE,
       linewidth = 1
    )+
    theme_grafs()
)
```

```{r Sumário OD, echo = FALSE, warning=FALSE, message = FALSE,}
(sum_od_p1 <- plan_wide_19902020 %>%
    select(codigo, oxigenio_dissolvido, ano_coleta) %>% 
    filter(ano_coleta > "1990" &
             ano_coleta <= "2000") %>% 
   group_by(codigo) %>% 
   # codigo == "87398500" <- "teste1"
    # %>% 
 summarize(
       max = 
         max(oxigenio_dissolvido, na.rm = TRUE),
       p95 = 
         quantile(oxigenio_dissolvido, 0.95, na.rm = TRUE),
       p80 = 
         quantile(oxigenio_dissolvido, 0.80, na.rm = TRUE),
       median = 
         median(oxigenio_dissolvido, na.rm = TRUE),
       mean = 
         mean(oxigenio_dissolvido, na.rm= TRUE),
       p20 = 
         quantile(oxigenio_dissolvido, 0.20, na.rm = TRUE),
       p05 = 
         quantile(oxigenio_dissolvido, 0.05, na.rm = TRUE),
       min = 
         min(oxigenio_dissolvido, na.rm = TRUE),
       n = 
         length(oxigenio_dissolvido)
 ) %>% 
    pivot_longer(
       !codigo,
       names_to = "par",
       values_to = "valor"
    ) %>% 
    pivot_wider(names_from = codigo,
                values_from = valor) %>% 
   rename(
     "PM1" = "87398500",
     "PM2" = "87398900",
     "PM3" = "87398950",
     "PM4" = "87398980",
     "PM5" = "87405500",
     "PM6" = "87406900",
     "PM7" = "87409900"
   ) 
 )

# teste1 <- parametros_IQA %>% 
#   group_by(codigo) %>% 
#   pivot_longer(
#     !codigo,
#     names_to = "parametro",
#     values_to = "valor"
#   ) %>% 
#   # group_by(parametro)
#   pivot_wider(
#     names_from = codigo,
#     values_from = valor,
#     # .groups = "drop"
#   ) %>% 
#   rename(
#     "PM1" = "87398500",
#     "PM2" = "87398900",
#     "PM3" = "87398950",
#     "PM4" = "87398980",
#     "PM5" = "87405500",
#     "PM6" = "87406900",
#     "PM7" = "87409900"
#   ) %>%
#   select(par, PM1, PM2, PM3, PM4, PM5, PM6, PM7) %>% 
#   filter(
#     par == "pH"
#   ) 
# %>% 
#   unnest(dplyr::everything())


# teste1$PM1[2]

# %>%
#   summarize(
#     max =
#       max(oxigenio_dissolvido, na.rm = TRUE),
#     q3 =
#       quantile(oxigenio_dissolvido, 0.75, na.rm = TRUE),
#     median =
#       median(oxigenio_dissolvido, na.rm = TRUE),
#     mean =
#       mean(oxigenio_dissolvido, na.rm= TRUE),
#     q1 =
#       quantile(oxigenio_dissolvido, 0.25, na.rm = TRUE),
#     min =
#       min(oxigenio_dissolvido, na.rm = TRUE),
#     n =
#       length(oxigenio_dissolvido)
#     )
# #     
# 
# sum(sum_od_p1$n)



(sum_od_p2 <- plan_wide_19902020 %>%
      select(codigo, oxigenio_dissolvido, ano_coleta) %>% 
      filter(ano_coleta>"2000" &
                ano_coleta<="2010") %>% 
      group_by(codigo) %>% 
      summarize(
         min = 
            min(oxigenio_dissolvido, na.rm = TRUE),
         q1 = 
            quantile(oxigenio_dissolvido, 0.25, na.rm = TRUE),
         median = 
            median(oxigenio_dissolvido, na.rm = TRUE),
         mean = 
            mean(oxigenio_dissolvido, na.rm= TRUE),
         q3 = 
            quantile(oxigenio_dissolvido, 0.75, na.rm = TRUE),
         max = 
            max(oxigenio_dissolvido, na.rm = TRUE)
      )
)

(sum_od_p3 <- plan_wide_19902020 %>%
      select(codigo, oxigenio_dissolvido, ano_coleta) %>% 
      filter(ano_coleta>"2010" &
                ano_coleta<="2020") %>% 
      group_by(codigo) %>% 
      summarize(
         min = 
            min(oxigenio_dissolvido, na.rm = TRUE),
         q1 = 
            quantile(oxigenio_dissolvido, 0.25, na.rm = TRUE),
         median = 
            median(oxigenio_dissolvido, na.rm = TRUE),
         mean = 
            mean(oxigenio_dissolvido, na.rm= TRUE),
         q3 = 
            quantile(oxigenio_dissolvido, 0.75, na.rm = TRUE),
         max = 
            max(oxigenio_dissolvido, na.rm = TRUE)
      )
)

#   pivot_wider(id_cols = codigo,
#               names_from = codigo,
#               values_from = oxigenio_dissolvido)
# 
# 
#   group_by(codigo) %>%
#   get_summary_stats(type = "common") %>%
#   pivot_wider(id_cols = variable,
#               names_from = codigo,
#               values_from = variable$oxigenio_dissolvido)
# 
# # install.packages("ggpubr")
# # library(ggpubr)
```

### Demanda Bioquímica de Oxigênio

```{r Gráfico DBO facetted, echo = TRUE, fig.cap="Demanda Bioquímica de Oxigênio no período 1990-2020"}
(dbo <- plan_wide_19902020 %>% 
  boxplot_dbo(
    titulo = "Demanda Bioquímica de Oxigênio no período 1990-2020",
  )+
  facet_wrap(~periodo)
 )
```

```{r Gráfico DBO período1, echo = FALSE, warning = FALSE, message = FALSE}
(dbo_p1 <- plan_wide_19902020 %>% 
   filter(ano_coleta>"1990" &
            ano_coleta<="2000") %>% 
   boxplot_dbo(
    titulo = "Demanda Bioquímica de Oxigênio no período 1990-2000",
  )
)
```

```{r Gráfico DBO período2, echo = FALSE, warning = FALSE, message = FALSE}
(dbo_p2 <- plan_wide_19902020 %>% 
   filter(ano_coleta>"2000" &
            ano_coleta<="2010") %>% 
   boxplot_dbo(
    titulo = "Demanda Bioquímica de Oxigênio no período 2000-2010",
  )
)
```

```{r Gráfico DBO período3, echo = FALSE, warning = FALSE, message = FALSE}
(dbo_p3 <- plan_wide_19902020 %>% 
   filter(ano_coleta > "2010" &
          ano_coleta <= "2020") %>% 
   boxplot_dbo(
    titulo = "Demanda Bioquímica de Oxigênio no período 2010-2020",
  )
)
```

```{r Gráfico IQA DBO periodo1, echo = FALSE, warning = FALSE, message = FALSE}
(iqa_dbo1<-ggplot(plan_wide_19902020 %>% 
                    filter(ano_coleta>"1990" &
                             ano_coleta<="2000"),
                  aes(codigo,
                      iqa_dbo))+
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=-Inf,
            ymax=19,
            alpha=1,
            fill="#ac5079")+ #>pior classe
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=19,
            ymax=36,
            alpha=1,
            fill="#eb5661")+ #classe 4
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=36,
            ymax=51,
            alpha=1,
            fill="#fcf7ab")+ #classe 3
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=51,
            ymax=79,
            alpha=1,
            fill="#70c18c")+ #classe 2
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=79,
            ymax=Inf,
            alpha=1,
            fill="#8dcdeb")+ #classe 1))
   stat_boxplot(geom = 'errorbar',
                width=0.3,
                position = position_dodge(width = 0.65),
                na.rm = TRUE)+
   geom_boxplot(fill='#F8F8FF',
                color="black",
                outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
                width= 0.7)+
   labs(title = "Variação do IQA para o parâmetro DBO 1990-2020",
        x="Estação",
        y="mg/L")+
   ggbeeswarm::geom_quasirandom(
     size = 1.2,
     alpha = .25,
     width = .07,
   )+
   scale_y_continuous(expand = expansion(mult = c(0,0)),
                      n.breaks = 6,
                      limits = c(-1,101))+
    scale_x_discrete(limits = c("87398500", 
                                "87398980", 
                                "87398900", 
                                "87398950", 
                                "87405500", 
                                "87406900", 
                                "87409900"),
                     labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
    )+
    geom_smooth(method = "lm",
                se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
                aes(group=1),
                alpha=.5,
                na.rm = TRUE,
                linewidth = 1)+
    theme_grafs()
)
```

```{r Gráfico IQA DBO periodo2, echo = FALSE, warning = FALSE, message = FALSE}
(iqa_dbo2<-ggplot(plan_wide_19902020%>% 
                     filter(ano_coleta>"2000" &
                               ano_coleta<="2010"),
                  aes(codigo,
                      iqa_dbo))+
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=-Inf,
             ymax=19,
             alpha=1,
             fill="#ac5079")+ #>pior classe
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=19,
             ymax=36,
             alpha=1,
             fill="#eb5661")+ #classe 4
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=36,
             ymax=51,
             alpha=1,
             fill="#fcf7ab")+ #classe 3
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=51,
             ymax=79,
             alpha=1,
             fill="#70c18c")+ #classe 2
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=79,
             ymax=Inf,
             alpha=1,
             fill="#8dcdeb")+ #classe 1))
    stat_boxplot(geom = 'errorbar',
                 width=0.3,
                 position = position_dodge(width = 0.65),
                 na.rm = TRUE)+
    geom_boxplot(fill='#F8F8FF',
                 color="black",
                 outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
                 width= 0.7)+
    labs(title = "Variação do IQA para o parâmetro DBO 2000-2010",
         x="Estação",
         y="mg/L")+
    ggbeeswarm::geom_quasirandom(
       size = 1.2,
       alpha = .25,
       width = .07,
    )+
    scale_y_continuous(expand = expansion(mult = c(0,0)),
                       n.breaks = 6,
                       limits = c(-1,101))+
    scale_x_discrete(limits = c("87398500", 
                                "87398980", 
                                "87398900", 
                                "87398950", 
                                "87405500", 
                                "87406900", 
                                "87409900"),
                     labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
    )+
    geom_smooth(method = "lm",
                se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
                aes(group=1),
                alpha=.5,
                na.rm = TRUE,
                linewidth = 1)+
    theme_grafs()
)
```

```{r Gráfico IQA DBO periodo3, echo = FALSE, warning = FALSE, message = FALSE}
(iqa_dbo3<-ggplot(plan_wide_19902020%>% 
                     filter(ano_coleta>"2010" &
                               ano_coleta<="2020"),
                  aes(codigo,
                      iqa_dbo))+
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=-Inf,
             ymax=19,
             alpha=1,
             fill="#ac5079")+ #>pior classe
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=19,
             ymax=36,
             alpha=1,
             fill="#eb5661")+ #classe 4
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=36,
             ymax=51,
             alpha=1,
             fill="#fcf7ab")+ #classe 3
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=51,
             ymax=79,
             alpha=1,
             fill="#70c18c")+ #classe 2
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=79,
             ymax=Inf,
             alpha=1,
             fill="#8dcdeb")+ #classe 1))
    stat_boxplot(geom = 'errorbar',
                 width=0.3,
                 position = position_dodge(width = 0.65),
                 na.rm = TRUE)+
    geom_boxplot(fill='#F8F8FF',
                 color="black",
                 outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
                 width= 0.7)+
    labs(title = "Variação do IQA para o parâmetro DBO 2010-2020",
         x="Estação",
         y="mg/L")+
    ggbeeswarm::geom_quasirandom(
       size = 1.2,
       alpha = .25,
       width = .07,
    )+
    scale_y_continuous(expand = expansion(mult = c(0,0)),
                       n.breaks = 6,
                       limits = c(-1,101))+
   scale_x_discrete(limits = c("87398500", 
                               "87398980", 
                               "87398900", 
                               "87398950", 
                               "87405500", 
                               "87406900", 
                               "87409900"),
                    labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
   )+
        geom_smooth(method = "lm",
                se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
                aes(group=1),
                alpha=.5,
                na.rm = TRUE,
                linewidth = 1)+
    theme_grafs()
)
```

```{r Sumário DBO, warning=FALSE, message = FALSE,}
(sum_dbo_p1 <- plan_wide_19902020 %>%
   select(codigo, dbo, ano_coleta) %>% 
   filter(ano_coleta>"1990" &
            ano_coleta<="2000") %>% 
   group_by(codigo) %>% 
   summarize(
     min = 
       min(dbo, 
           na.rm = TRUE),
     q1 = 
       quantile(dbo, 0.25, 
                na.rm = TRUE),
     median = 
       median(dbo, 
              na.rm = TRUE),
     mean = 
       mean(dbo, 
            na.rm= TRUE),
     q3 = 
       quantile(dbo, 0.75, 
                na.rm = TRUE),
     max = 
       max(dbo, 
           na.rm = TRUE))
)

(sum_dbo_p2 <- plan_wide_19902020 %>%
    select(codigo, dbo, ano_coleta) %>% 
    filter(ano_coleta>"2000" &
             ano_coleta<="2010") %>% 
    group_by(codigo) %>% 
    summarize(
      min = 
        min(dbo, 
            na.rm = TRUE),
      q1 = 
        quantile(dbo, 0.25, 
                 na.rm = TRUE),
      median = 
        median(dbo, 
               na.rm = TRUE),
      mean = 
        mean(dbo, 
             na.rm= TRUE),
      q3 = 
        quantile(dbo, 0.75, 
                 na.rm = TRUE),
      max = 
        max(dbo, 
            na.rm = TRUE))
)

(sum_dbo_p3 <- plan_wide_19902020 %>%
    select(codigo, dbo, ano_coleta) %>% 
    filter(ano_coleta>"2010" &
             ano_coleta<="2020") %>% 
    group_by(codigo) %>% 
    summarize(
      min = 
        min(dbo, 
            na.rm = TRUE),
      q1 = 
        quantile(dbo, 0.25, 
                 na.rm = TRUE),
      median = 
        median(dbo, 
               na.rm = TRUE),
      mean = 
        mean(dbo, 
             na.rm= TRUE),
      q3 = 
        quantile(dbo, 0.75, 
                 na.rm = TRUE),
      max = 
        max(dbo, 
            na.rm = TRUE))
)
```

```{r Salvando DBO, warning=FALSE, message = FALSE,}
ggsave("dbo.png",
       units = c("px"),
       width = 4500,
       height = 2993,
       plot = dbo,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("dbo_p1.png",
       plot = dbo_p1,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("dbo_p2.png",
       plot = dbo_p2,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("dbo_p3.png",
       plot = dbo_p3,
       path = "./graficos",
       dpi = 300,
       type = "cairo")
```

### Fósforo total

```{r Gráfico fósforo total facetted, echo = TRUE, fig.cap="Fósforo total no período 1990-2020"}
(ptot <- plan_wide_19902020 %>% 
   boxplot_ptot(
     titulo = "Fósforo total no período 1990-2020",
   )+
   facet_wrap(~periodo)
)
```

```{r Gráfico Fósforo total periodo1, echo = FALSE, warning = FALSE, message = FALSE}
(ptot_p1 <- plan_wide_19902020%>% 
   filter(ano_coleta>"1990" &
            ano_coleta<="2000") %>% 
   boxplot_ptot(
     titulo = "Fósforo total no período 1990-2000",
   )
)
```

```{r Gráfico Fósforo total periodo2, echo = FALSE, warning = FALSE, message = FALSE}
(ptot_p2 <- plan_wide_19902020%>% 
   filter(ano_coleta>"2000" &
            ano_coleta<="2010") %>% 
   boxplot_ptot(
     titulo = "Fósforo total no período 2000-2010",
   )
)
```

```{r Gráfico Fósforo total periodo3, echo = FALSE, warning = FALSE, message = FALSE}
(ptot_p3 <- plan_wide_19902020 %>% 
   filter(ano_coleta>"2010" &
            ano_coleta<="2020") %>% 
   boxplot_ptot(
     titulo = "Fósforo total no período 2010-2020",
   )
)
```

```{r Sumário Fósforo total, warning=FALSE, message = FALSE,}
(sum_ptot_p1 <- plan_wide_19902020 %>%
    select(codigo, fosforo_total, ano_coleta) %>% 
   filter(ano_coleta>"1990" &
            ano_coleta<="2000") %>% 
   group_by(codigo) %>% 
   summarize(
     min = 
       min(fosforo_total, na.rm = TRUE),
     q1 = 
       quantile(fosforo_total, 0.25, na.rm = TRUE),
     median = 
       median(fosforo_total, na.rm = TRUE),
     mean = 
       mean(fosforo_total, na.rm= TRUE),
     q3 = 
       quantile(fosforo_total, 0.75, na.rm = TRUE),
     max = 
       max(fosforo_total, na.rm = TRUE)))

(sum_ptot_p2 <- plan_wide_19902020 %>%
    select(codigo, fosforo_total, ano_coleta) %>% 
    filter(ano_coleta>"2000" &
             ano_coleta<="2010") %>% 
    group_by(codigo) %>% 
    summarize(
      min = 
        min(fosforo_total, na.rm = TRUE),
      q1 = 
        quantile(fosforo_total, 0.25, na.rm = TRUE),
      median = 
        median(fosforo_total, na.rm = TRUE),
      mean = 
        mean(fosforo_total, na.rm= TRUE),
      q3 = 
        quantile(fosforo_total, 0.75, na.rm = TRUE),
      max = 
        max(fosforo_total, na.rm = TRUE)))

(sum_ptot_p3 <- plan_wide_19902020 %>%
    select(codigo, fosforo_total, ano_coleta) %>% 
    filter(ano_coleta>"2010" &
             ano_coleta<="2020") %>% 
    group_by(codigo) %>% 
    summarize(
      min = 
        min(fosforo_total, na.rm = TRUE),
      q1 = 
        quantile(fosforo_total, 0.25, na.rm = TRUE),
      median = 
        median(fosforo_total, na.rm = TRUE),
      mean = 
        mean(fosforo_total, na.rm= TRUE),
      q3 = 
        quantile(fosforo_total, 0.75, na.rm = TRUE),
      max = 
        max(fosforo_total, na.rm = TRUE)))

```

```{r Salvando Ptot, warning=FALSE, message = FALSE,}
ggsave("ptot.png",
       units = c("px"),
       width = 4500,
       height = 2993,
       plot = ptot,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("ptot_p1.png",
       plot = ptot_p1,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("ptot_p2.png",
       plot = ptot_p2,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("ptot_p3.png",
       plot = ptot_p3,
       path = "./graficos",
       dpi = 300,
       type = "cairo")
```

### Escherichia coli

```{r Gráfico Ecoli facetted, fig.cap="Escherichia-coli-gravataí no período 1990-2020", warning = FALSE, message = FALSE}
(ecoli <- boxplot_ecoli(
  titulo = "*Escherichia coli* no período 1990-2020"
)+
  scale_y_continuous(expand = expansion(mult = c(0.01, 0.01)),
                     # n.breaks = 9,
                     n.breaks = 6,
                     limits = c(min(plan_wide_19902020$escherichia_coli, na.rm = TRUE),
                                max(plan_wide_19902020$escherichia_coli, na.rm = TRUE)),
                     trans = "log10",
                     # labels = scales::number_format(accuracy = 1,
                     #                                decimal.mark = ",",
                     #                                big.mark = " ")
  )+
  facet_wrap(~periodo)
)

(ecoli <- ggplot(plan_wide_19902020,
                 aes(codigo,
                     escherichia_coli))+
   annotate("rect",
            xmin=-Inf, xmax=Inf,
            ymin=3200, ymax=Inf,
            alpha=1,
            fill="#ac5079")+ #>pior classe
   annotate("rect",
            xmin=-Inf, xmax=Inf,
            ymin=800, ymax=3200,
            alpha=1,
            fill="#fcf7ab")+ #classe 3
   annotate("rect",
            xmin=-Inf, xmax=Inf,
            ymin=160, ymax=800,
            alpha=1,
            fill="#70c18c")+ #classe 2
   annotate("rect",
            xmin=-Inf, xmax=Inf,
            ymin=0, ymax=160,
            alpha=1,
            fill="#8dcdeb")+ #classe 1
   stat_summary(
     fun.data = f,
     geom = 'errorbar',
     width = 0.3,
     position = position_dodge(width = 0.65),
   )+
   stat_summary(
     fun.data = f,
     geom = "boxplot",
     width = 0.7,
     fill = '#F8F8FF',
     color = "black",
     outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
   )+
   facet_wrap(~periodo)+
   labs(title = "*Escherichia coli* no período 1990-2020",
        x="Estação",
        y="NMP/100mL")+
   scale_y_continuous(expand = expansion(mult = c(0.01, 0.01)),
                      # n.breaks = 9,
                      n.breaks = 6,
                      limits = c(min(plan_wide_19902020$escherichia_coli, na.rm = TRUE),
                                 max(plan_wide_19902020$escherichia_coli, na.rm = TRUE)),
                      trans = "log10",
                      # labels = scales::number_format(accuracy = 1,
                      #                                decimal.mark = ",",
                      #                                big.mark = " ")
                      )+
   ggbeeswarm::geom_quasirandom(
     size = 1.2,
     alpha = .25,
     width = .07,
   )+
   scale_x_discrete(limits = c("87398500", 
                               "87398980", 
                               "87398900", 
                               "87398950", 
                               "87405500", 
                               "87406900", 
                               "87409900"),
                    labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
   )+
   geom_smooth(method = "lm",
               se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
               aes(group=1),
               alpha=.5,
               na.rm = TRUE,
               linewidth = 1)+
   theme_grafs()+
    theme(
        axis.text.y = element_text(
          angle = 90, 
          # size=15,
          # face=2
        ),
        plot.title = 
          element_markdown(
            hjust = 0.5,
            color = "black",
            size = 19)
    )
)
```

```{r Gráfico Ecoli periodo1, warning = FALSE, message = FALSE}
(ecoli_p1 <- ggplot(plan_wide_19902020 %>% 
                       filter(ano_coleta>"1990" &
                                 ano_coleta<="2000"),
                    aes(codigo,
                        escherichia_coli))+
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=3200,
             ymax=Inf,
             alpha=1,
             fill="#ac5079")+ #>pior classe
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=800,
             ymax=3200,
             alpha=1,
             fill="#fcf7ab")+ #classe 3
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=160,
             ymax=800,
             alpha=1,
             fill="#70c18c")+ #classe 2
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=0,
             ymax=160,
             alpha=1,
             fill="#8dcdeb")+ #classe 1
    stat_boxplot(geom = 'errorbar',
                 width=0.3,
                 position = position_dodge(width = 0.65))+
    geom_boxplot(fill='#F8F8FF',
                 color="black",
                 outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
                 width= 0.7)+
    labs(title = "Escherichia coli no período 1990-2000",
         x="Estação",
         y="NMP/100mL")+
   scale_y_continuous(expand = expansion(mult = c(0.01, 0.01)),
                      n.breaks = 9,
                      limits = c(min(plan_wide_19902020$escherichia_coli, na.rm = TRUE),
                                 max(plan_wide_19902020$escherichia_coli, na.rm = TRUE)),
                      trans = "log10",
                      labels = scales::number_format(accuracy = 1,
                                                     decimal.mark = ",",
                                                     big.mark = " "))+
    ggbeeswarm::geom_quasirandom(
       size = 1.2,
       alpha = .25,
       width = .07,
    )+
    scale_x_discrete(limits = c("87398500", 
                                "87398980", 
                                "87398900", 
                                "87398950", 
                                "87405500", 
                                "87406900", 
                                "87409900"),
                     labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
    )+
    geom_smooth(method = "lm",
                se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
                aes(group=1),
                alpha=.5,
                na.rm = TRUE,
                linewidth = 1)+
    theme_grafs()
)
```

```{r Gráfico Ecoli periodo2, warning = FALSE, message = FALSE}
(ecoli_p2 <- ggplot(plan_wide_19902020 %>% 
                       filter(ano_coleta>"2000" &
                                 ano_coleta<="2010"),
                    aes(codigo,
                        escherichia_coli))+
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=3200,
             ymax=Inf,
             alpha=1,
             fill="#ac5079")+ #>pior classe
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=800,
             ymax=3200,
             alpha=1,
             fill="#fcf7ab")+ #classe 3
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=160,
             ymax=800,
             alpha=1,
             fill="#70c18c")+ #classe 2
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=0,
             ymax=160,
             alpha=1,
             fill="#8dcdeb")+ #classe 1
    stat_boxplot(geom = 'errorbar',
                 width=0.3,
                 position = position_dodge(width = 0.65))+
    geom_boxplot(fill='#F8F8FF',
                 color="black",
                 outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
                 width= 0.7)+
    labs(title = "Escherichia coli no período 2000-2010",
         x="Estação",
         y="NMP/100mL")+
    scale_y_continuous(expand = expansion(mult = c(0.01, 0.01)),
                       n.breaks = 9,
                       limits = c(min(plan_wide_19902020$escherichia_coli, na.rm = TRUE),
                                  max(plan_wide_19902020$escherichia_coli, na.rm = TRUE)),
                       trans = "log10",
                       labels = scales::number_format(accuracy = 1,
                                                      decimal.mark = ",",
                                                      big.mark = " "))+
   ggbeeswarm::geom_quasirandom(
     size = 1.2,
     alpha = .25,
     width = .07,
   )+
   scale_x_discrete(limits = c("87398500", 
                               "87398980", 
                               "87398900", 
                               "87398950", 
                               "87405500", 
                               "87406900", 
                               "87409900"),
                    labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
   )+
    geom_smooth(method = "lm",
                se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
                aes(group=1),
                alpha=.5,
                na.rm = TRUE,
                linewidth = 1)+
    theme_grafs()
)
```

```{r Gráfico Ecoli periodo3, warning = FALSE, message = FALSE}
(ecoli_p3 <- ggplot(plan_wide_19902020 %>% 
                       filter(ano_coleta>"2010" &
                                 ano_coleta<="2020"),
                    aes(codigo,
                        escherichia_coli))+
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=3200,
             ymax=Inf,
             alpha=1,
             fill="#ac5079")+ #>pior classe
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=800,
             ymax=3200,
             alpha=1,
             fill="#fcf7ab")+ #classe 3
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=160,
             ymax=800,
             alpha=1,
             fill="#70c18c")+ #classe 2
    annotate("rect",
             xmin=-Inf,
             xmax=Inf,
             ymin=0,
             ymax=160,
             alpha=1,
             fill="#8dcdeb")+ #classe 1
    stat_boxplot(geom = 'errorbar',
                 width=0.3,
                 position = position_dodge(width = 0.65))+
    geom_boxplot(fill='#F8F8FF',
                 color="black",
                 outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
                 width= 0.7)+
    labs(title = "Escherichia coli no período 2010-2020",
         x="Estação",
         y="NMP/100mL")+
    scale_y_continuous(expand = expansion(mult = c(0.01, 0.01)),
                       n.breaks = 9,
                       limits = c(min(plan_wide_19902020$escherichia_coli, na.rm = TRUE),
                                  max(plan_wide_19902020$escherichia_coli, na.rm = TRUE)),
                       trans = "log10",
                       labels = scales::number_format(accuracy = 1,
                                                      decimal.mark = ",",
                                                      big.mark = " "))+
    ggbeeswarm::geom_quasirandom(
     size = 1.2,
     alpha = .25,
     width = .07,
   )+
   scale_x_discrete(limits = c("87398500", 
                               "87398980", 
                               "87398900", 
                               "87398950", 
                               "87405500", 
                               "87406900", 
                               "87409900"),
                    labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
   )+
    geom_smooth(method = "lm",
                se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
                aes(group=1),
                alpha=.5,
                na.rm = TRUE,
                linewidth = 1)+
    theme_grafs()
)
```

```{r Sumário Ecoli, warning=FALSE, message = FALSE,}
(sum_ecoli_p1 <- plan_wide_19902020 %>%
    select(codigo, escherichia_coli, ano_coleta) %>% 
    filter(ano_coleta>"1990" &
              ano_coleta<="2000") %>% 
   group_by(codigo) %>% 
   summarize(
     min = 
       min(escherichia_coli, 
           na.rm = TRUE),
     q1 = 
       quantile(escherichia_coli, 0.25, 
                na.rm = TRUE),
     median = 
       median(escherichia_coli, 
              na.rm = TRUE),
     mean = 
       mean(escherichia_coli, 
            na.rm= TRUE),
     q3 = 
       quantile(escherichia_coli, 0.75, 
                na.rm = TRUE),
     max = 
       max(escherichia_coli, 
           na.rm = TRUE))
)

(sum_ecoli_p2 <- plan_wide_19902020 %>%
    select(codigo, escherichia_coli, ano_coleta) %>% 
    filter(ano_coleta>"2000" &
             ano_coleta<="2010") %>% 
    group_by(codigo) %>% 
    summarize(
      min = 
        min(escherichia_coli, 
            na.rm = TRUE),
      q1 = 
        quantile(escherichia_coli, 0.25, 
                 na.rm = TRUE),
      median = 
        median(escherichia_coli, 
               na.rm = TRUE),
      mean = 
        mean(escherichia_coli, 
             na.rm= TRUE),
      q3 = 
        quantile(escherichia_coli, 0.75, 
                 na.rm = TRUE),
      max = 
        max(escherichia_coli, 
            na.rm = TRUE))
)

(sum_ecoli_p3 <- plan_wide_19902020 %>%
    select(codigo, escherichia_coli, ano_coleta) %>% 
    filter(ano_coleta>"2010" &
             ano_coleta<="2020") %>% 
    group_by(codigo) %>% 
    summarize(
      min = 
        min(escherichia_coli, 
            na.rm = TRUE),
      q1 = 
        quantile(escherichia_coli, 0.25, 
                 na.rm = TRUE),
      median = 
        median(escherichia_coli, 
               na.rm = TRUE),
      mean = 
        mean(escherichia_coli, 
             na.rm= TRUE),
      q3 = 
        quantile(escherichia_coli, 0.75, 
                 na.rm = TRUE),
      max = 
        max(escherichia_coli, 
            na.rm = TRUE))
)
```

```{r Salvando ecoli, warning=FALSE, message = FALSE,}
ggsave("ecoli.png",
       plot = ecoli,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("ecoli_p1.png",
       plot = ecoli_p1,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("ecoli_p2.png",
       plot = ecoli_p2,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("ecoli_p3.png",
       plot = ecoli_p3,
       path = "./graficos",
       dpi = 300,
       type = "cairo")
```

### Nitrogênio amoniacal

```{r Gráfico Nitrogênio total facetted, fig.cap="nitrogenio-gravataí no período 1990-2020", warning = FALSE, message = FALSE}
(namon <- plan_wide_19902020 %>% 
  boxplot_namon(
    eixo_y = nitrogenio_amoniacal,
    titulo = "Nitrogênio Amoniacal no período 1990-2020"
    )+
  facet_wrap(~periodo)
 )
```

```{r Gráfico Nitrogênio line, warning = FALSE, message = FALSE}
periodo_inicial <- as.Date("1990-01-01", "%Y-%m-%d")
periodo_final <- as.Date("2021-01-01",  "%Y-%m-%d")

(nitro_line <- 
  plan_wide_19902020 %>%
  filter(ano_coleta > "1990" &
           ano_coleta <= "2020") %>%
  dplyr::select(codigo, nitrogenio_amoniacal, data_coleta, periodo) %>%
  # group_by(codigo) %>%
  mutate(
    ponto_monitoramento = case_when(
      codigo == "87398500" ~ "PM1",
      codigo == "87398980" ~ "PM2",
      codigo == "87398900" ~ "PM3",
      codigo == "87398950" ~ "PM4",
      codigo == "87405500" ~ "PM5",
      codigo == "87406900" ~ "PM6",
      codigo == "87409900" ~ "PM7"
    )
  ) %>% 
    # pivot_wider(
    #   names_from = codigo,
    #   values_from = nitro_amon,
    #   id_cols = data_coleta
    # ) %>% 
    ggplot(
      aes(x = data_coleta,
          y = nitrogenio_amoniacal,
          # color = codigo
      ))+
    # geom_rect(
    #   aes(xmin = periodo_inicial, 
    #       xmax = periodo_final,
    #       ymin = 13.3, 
    #       ymax = Inf,
    #       alpha= 0.005,
    #       fill= "#ac5079"),
    # show.legend = FALSE)+ #>pior classe
    # geom_rect(
    #   aes(xmin = periodo_inicial, 
    #       xmax = periodo_final,
  #       ymin= 3.7,
  #       ymax= 13.3,
  #       alpha= 0.005,
  #       fill= "#fcf7ab"),
  #    show.legend = FALSE)+ #classe 3
  # geom_rect(
  #   aes(xmin = periodo_inicial, 
  #       xmax = periodo_final,
  #       ymin= 0,
  #       ymax= 3.7,
  #       alpha= 0.005,
  #       fill= "blue"
  #         # "#8dcdeb"
  #         ),
  #    show.legend = FALSE)+ #classe 1
  annotate("rect",
           xmin= periodo_inicial,
           xmax= periodo_final,
           ymin=13.3,
           ymax=Inf,
           alpha= 0.7,
           fill="#ac5079")+ #>pior classe
    annotate("rect",
             xmin= periodo_inicial,
             xmax= periodo_final,
             ymin=3.7,
             ymax=13.3,
             alpha= 0.7,
             fill="#fcf7ab")+ #classe 3
    annotate("rect",
             xmin= periodo_inicial,
             xmax= periodo_final,
             ymin= -Inf,
             ymax=3.7,
             alpha= 0.7,
             fill="#8dcdeb")+ #classe 1
    geom_line(
      # aes(color = codigo),
      na.rm = TRUE)+
    geom_point(
      # aes(color = codigo),
      na.rm = TRUE)+
    scale_x_date(
      limits = as.Date(c(
        "1990-01-01", 
        "2021-01-01"
        # NA #pode usar NA também
      )),
      expand = c(0.0, 0.0),
      date_breaks = "10 years",
      minor_breaks = "5 years",
      date_labels = "%Y",
    )+
    # geom_smooth(
    #   # aes(color = codigo),
    #   method = "lm",
    #   # formula = y ~ poly(x, 2),
    #   # span = 0.2,
    #   se = TRUE, #se deixar TRUE gera o intervalo de confiança de 95%
    #   aes(group = 1),
    #   alpha =.5,
    #   na.rm = TRUE,
    #   linewidth = 0.3,
    #   # fullrange = TRUE,
  #   # show.legend = TRUE
  # )+
  # stat_smooth(
  #   geom = "smooth",
  #   # span = 0.2,
  #   se = FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
  #   # aes(group = 1),
  #   # alpha =.5,
  #   na.rm = TRUE,
  #   # linewidth = 0.3,
  #   fullrange = TRUE,
  #   show.legend = TRUE
  # )+
  facet_wrap(
    ~ponto_monitoramento,
    nrow = 4,
  )+
    theme_bw()
)
```

```{r Gráfico Nitrogênio total periodo1, warning = FALSE, message = FALSE}
(namon_p1 <- plan_wide_19902020 %>% 
   filter(ano_coleta>"1990" &
            ano_coleta<="2000") %>% 
   boxplot_namon(
     titulo = "Nitrogênio Amoniacal no período 1990-2000"
   )
 )
```

```{r Gráfico Nitrogênio total periodo2, warning = FALSE, message = FALSE}
(namon_p2 <- plan_wide_19902020 %>% 
   filter(ano_coleta>"2000" &
            ano_coleta<="2010") %>% 
   boxplot_namon(
     titulo = "Nitrogênio Amoniacal no período 2000-2010"
   )
 )
```

```{r Gráfico Nitrogênio total periodo3, warning = FALSE, message = FALSE}
(namon_p3 <- plan_wide_19902020 %>% 
   filter(ano_coleta>"2010" &
            ano_coleta<="2020") %>% 
   boxplot_namon(
     titulo = "Nitrogênio Amoniacal no período 2010-2020"
   )
 )
```

```{r Sumário Nitrogênio total, warning=FALSE, message = FALSE,}
(sum_namon_p1 <- plan_wide_19902020 %>%
   select(codigo, nitrogenio_amoniacal, ano_coleta) %>% 
   filter(ano_coleta>"1990" &
            ano_coleta<="2000") %>% 
   group_by(codigo) %>% 
   summarize(
     min = 
       min(nitrogenio_amoniacal, 
           na.rm = TRUE),
     q1 = 
       quantile(nitrogenio_amoniacal, 0.25, 
                na.rm = TRUE),
     median = 
       median(nitrogenio_amoniacal, 
              na.rm = TRUE),
     mean = 
       mean(nitrogenio_amoniacal, 
            na.rm= TRUE),
     q3 = 
       quantile(nitrogenio_amoniacal, 0.75, 
                na.rm = TRUE),
     max = 
       max(nitrogenio_amoniacal, 
           na.rm = TRUE),
      n = 
       length(nitrogenio_amoniacal)
   )
)

(sum_namon_p2 <- plan_wide_19902020 %>%
    select(codigo, nitrogenio_amoniacal, ano_coleta) %>% 
    filter(ano_coleta>"2000" &
             ano_coleta<="2010") %>% 
    group_by(codigo) %>% 
    summarize(
      min = 
        min(nitrogenio_amoniacal, 
            na.rm = TRUE),
      q1 = 
        quantile(nitrogenio_amoniacal, 0.25, 
                 na.rm = TRUE),
      median = 
        median(nitrogenio_amoniacal, 
               na.rm = TRUE),
      mean = 
        mean(nitrogenio_amoniacal, 
             na.rm= TRUE),
      q3 = 
        quantile(nitrogenio_amoniacal, 0.75, 
                 na.rm = TRUE),
      max = 
        max(nitrogenio_amoniacal, 
            na.rm = TRUE))
)

(sum_namon_p3 <- plan_wide_19902020 %>%
    select(codigo, nitrogenio_amoniacal, ano_coleta) %>% 
    filter(ano_coleta>"2010" &
             ano_coleta<="2020") %>% 
    group_by(codigo) %>% 
    summarize(
      min = 
        min(nitrogenio_amoniacal, 
            na.rm = TRUE),
      q1 = 
        quantile(nitrogenio_amoniacal, 0.25, 
                 na.rm = TRUE),
      median = 
        median(nitrogenio_amoniacal, 
               na.rm = TRUE),
      mean = 
        mean(nitrogenio_amoniacal, 
             na.rm= TRUE),
      q3 = 
        quantile(nitrogenio_amoniacal, 0.75, 
                 na.rm = TRUE),
      max = 
        max(nitrogenio_amoniacal, 
            na.rm = TRUE))
)
```

```{r Salvando namon, warning=FALSE, message = FALSE,}
ggsave("namon.png",
       units = c("px"),
       width = 4500,
       height = 2993,
       plot = namon,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("namon_p1.png",
       plot = namon_p1,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("namon_p2.png",
       plot = namon_p2,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("namon_p3.png",
       plot = namon_p3,
       path = "./graficos",
       dpi = 300,
       type = "cairo")
```

### Turbidez

```{r Gráfico Turbidez facetted, fig.cap="turbidez-gravataí no período 1990-2020", warning = FALSE, message = FALSE}
(turb <- plan_wide_19902020 %>% 
   boxplot_turb(
     titulo = "Turbidez no período 1990-2020"
   )+
   facet_wrap(~periodo)
 )
```

```{r Gráfico Turbidez line, warning = FALSE, message = FALSE}
(turb_line <- plan_wide_19902020 %>%
   filter(ano_coleta > "1990" &
            ano_coleta <= "2020") %>%
   select(codigo, turbidez, data_coleta, periodo) %>%
  group_by(codigo) %>%
  ggplot(
    aes(x = data_coleta,
        y = turbidez,
        color = codigo
    ))+
    geom_line(
      # aes(color = codigo),
      na.rm = TRUE)+
    geom_point(
      # aes(color = codigo),
      na.rm = TRUE)+
    scale_x_date(
      limits = as.Date(c(
        "1990-01-01", 
        "2021-01-01"
        # NA #pode usar NA também
      )),
      expand = c(0.0, 0.0),
      date_breaks = "10 years",
      minor_breaks = "5 years",
      date_labels = "%Y",
    )+
  # geom_smooth(
  #   # aes(color = codigo),
  #   method = "lm",
  #   # formula = y ~ poly(x, 2),
  #   # span = 0.2,
  #   se = TRUE, #se deixar TRUE gera o intervalo de confiança de 95%
  #   aes(group = 1),
  #   alpha =.5,
  #   na.rm = TRUE,
  #   linewidth = 0.3,
  #   # fullrange = TRUE,
  #   # show.legend = TRUE
  # )+
  # stat_smooth(
  #   geom = "smooth",
  #   # span = 0.2,
  #   se = FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
  #   # aes(group = 1),
  #   # alpha =.5,
  #   na.rm = TRUE,
  #   # linewidth = 0.3,
  #   fullrange = TRUE,
  #   show.legend = TRUE
  # )+
  facet_wrap(
    ~codigo,
    nrow = 4,
  )+
  theme_bw()
)
```

```{r Gráfico Turbidez periodo1, warning = FALSE, message = FALSE}
(turb_p1 <- plan_wide_19902020 %>% 
   filter(ano_coleta>"1990" &
            ano_coleta<="2000") %>% 
   boxplot_turb(
     titulo = "Turbidez no período 1990-2000"
   )
 )
```

```{r Gráfico Turbidez periodo2, warning = FALSE, message = FALSE}
(turb_p2 <- plan_wide_19902020 %>% 
   filter(ano_coleta>"2000" &
            ano_coleta<="2010") %>% 
   boxplot_turb(
     titulo = "Turbidez no período 2000-2010"
   )
 )
```

```{r Gráfico Turbidez periodo3, warning = FALSE, message = FALSE}
(turb_p3 <- plan_wide_19902020 %>% 
   filter(ano_coleta>"2010" &
            ano_coleta<="2020") %>% 
   boxplot_turb(
     titulo = "Turbidez no período 2010-2020"
   )
 )
```

```{r Sumário Turbidez, warning=FALSE, message = FALSE,}
(sum_turb_p1 <- plan_wide_19902020 %>%
   select(codigo, turbidez, ano_coleta) %>% 
   filter(ano_coleta>"1990" &
            ano_coleta<="2000") %>% 
   group_by(codigo) %>% 
   summarize(
     min = 
       min(turbidez, 
           na.rm = TRUE),
     q1 = 
       quantile(turbidez, 0.25, 
                na.rm = TRUE),
     median = 
       median(turbidez, 
              na.rm = TRUE),
     mean = 
       mean(turbidez, 
            na.rm= TRUE),
     q3 = 
       quantile(turbidez, 0.75, 
                na.rm = TRUE),
     max = 
       max(turbidez, 
           na.rm = TRUE))
)

(sum_turb_p2 <- plan_wide_19902020 %>%
    select(codigo, turbidez, ano_coleta) %>% 
    filter(ano_coleta>"2000" &
             ano_coleta<="2010") %>% 
    group_by(codigo) %>% 
    summarize(
      min = 
        min(turbidez, 
            na.rm = TRUE),
      q1 = 
        quantile(turbidez, 0.25, 
                 na.rm = TRUE),
      median = 
        median(turbidez, 
               na.rm = TRUE),
      mean = 
        mean(turbidez, 
             na.rm= TRUE),
      q3 = 
        quantile(turbidez, 0.75, 
                 na.rm = TRUE),
      max = 
        max(turbidez, 
            na.rm = TRUE))
)

(sum_turb_p3 <- plan_wide_19902020 %>%
    select(codigo, turbidez, ano_coleta) %>% 
    filter(ano_coleta>"2010" &
             ano_coleta<="2020") %>% 
    group_by(codigo) %>% 
    summarize(
      min = 
        min(turbidez, 
            na.rm = TRUE),
      q1 = 
        quantile(turbidez, 0.25, 
                 na.rm = TRUE),
      median = 
        median(turbidez, 
               na.rm = TRUE),
      mean = 
        mean(turbidez, 
             na.rm= TRUE),
      q3 = 
        quantile(turbidez, 0.75, 
                 na.rm = TRUE),
      max = 
        max(turbidez, 
            na.rm = TRUE))
) 
```

```{r Salvando turb, warning=FALSE, message = FALSE,}
ggsave("turb.png",
       units = c("px"),
       width = 4500,
       height = 2993,
       plot = turb,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("turb_p1.png",
       plot = turb_p1,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("turb_p2.png",
       plot = turb_p2,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("turb_p3.png",
       plot = turb_p3,
       path = "./graficos",
       dpi = 300,
       type = "cairo")
```

### pH

```{r Gráfico pH facetted, fig.cap="pH-gravataí no período 1990-2020", warning = FALSE, message = FALSE}
(pH <- boxplot_pH(
  titulo = "pH no período 1990-2020"
)+
  facet_wrap(~periodo)
)
```

```{r Gráfico pH periodo1, warning = FALSE, message = FALSE}
(pH_p1 <- plan_wide_19902020 %>% 
   filter(ano_coleta > "1990" &
            ano_coleta <= "2000") %>% 
   boxplot_pH(
     titulo = "pH no período 1990-2000"
   )
 )
```

```{r Gráfico pH periodo2, warning = FALSE, message = FALSE}
(pH_p2 <- plan_wide_19902020 %>% 
   filter(ano_coleta > "2000" &
            ano_coleta <= "2010") %>% 
   boxplot_pH(
     titulo = "pH no período 2000-2010"
   )
 )
```

```{r Gráfico pH periodo3, warning = FALSE, message = FALSE}
(pH_p3 <- plan_wide_19902020 %>% 
   filter(ano_coleta > "2010" &
            ano_coleta <= "2020") %>% 
   boxplot_pH(
     titulo = "pH no período 2010-2020"
   )
 )
```

```{r Sumário pH, warning=FALSE, message = FALSE,}
(sum_pH_p1 <- plan_wide_19902020 %>%
   select(codigo, pH, ano_coleta) %>% 
   filter(ano_coleta>"1990" &
            ano_coleta<="2000") %>% 
   group_by(codigo) %>% 
   summarize(
     min = 
       min(pH, 
           na.rm = TRUE),
     q1 = 
       quantile(pH, 0.25, 
                na.rm = TRUE),
     median = 
       median(pH, 
              na.rm = TRUE),
     mean = 
       mean(pH, 
            na.rm= TRUE),
     q3 = 
       quantile(pH, 0.75, 
                na.rm = TRUE),
     max = 
       max(pH, 
           na.rm = TRUE))
)

(sum_pH_p2 <- plan_wide_19902020 %>%
    select(codigo, pH, ano_coleta) %>% 
    filter(ano_coleta>"2000" &
             ano_coleta<="2010") %>% 
    group_by(codigo) %>% 
    summarize(
      min = 
        min(pH, 
            na.rm = TRUE),
      q1 = 
        quantile(pH, 0.25, 
                 na.rm = TRUE),
      median = 
        median(pH, 
               na.rm = TRUE),
      mean = 
        mean(pH, 
             na.rm= TRUE),
      q3 = 
        quantile(pH, 0.75, 
                 na.rm = TRUE),
      max = 
        max(pH, 
            na.rm = TRUE))
) 

(sum_pH_p3 <- plan_wide_19902020 %>%
    select(codigo, pH, ano_coleta) %>% 
    filter(ano_coleta>"2010" &
             ano_coleta<="2020") %>% 
    group_by(codigo) %>% 
    summarize(
      min = 
        min(pH, 
            na.rm = TRUE),
      q1 = 
        quantile(pH, 0.25, 
                 na.rm = TRUE),
      median = 
        median(pH, 
               na.rm = TRUE),
      mean = 
        mean(pH, 
             na.rm= TRUE),
      q3 = 
        quantile(pH, 0.75, 
                 na.rm = TRUE),
      max = 
        max(pH, 
            na.rm = TRUE))
)
```

```{r Salvando pH, warning=FALSE, message = FALSE,}
ggsave("pH.png",
       units = c("px"),
       width = 4500,
       height = 2993,
       plot = pH,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("pH_p1.png",
       plot = pH_p1,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("pH_p2.png",
       plot = pH_p2,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("pH_p3.png",
       plot = pH_p3,
       path = "./graficos",
       dpi = 300,
       type = "cairo")
```

### Sólidos totais

```{r Gráfico SólTot facetted, fig.cap="sólidos-totais-gravataí no período 1990-2020", warning = FALSE, message = FALSE}
(SolTot <- plan_wide_19902020 %>% 
   boxplot_solidos_totais(
     titulo = "Sólidos totais no período 1990-2020"
   )+
   facet_wrap(~periodo)
)
```

```{r Gráfico SólTot periodo1, warning = FALSE, message = FALSE}
(SolTot_p1 <- plan_wide_19902020 %>% 
   filter(ano_coleta>"1990" &
          ano_coleta<="2000") %>% 
   boxplot_solidos_totais(
     titulo = "Sólidos totais no período 1990-2000"
   )
 )
```

```{r Gráfico SólTot periodo2, warning = FALSE, message = FALSE}
(SolTot_p2 <- plan_wide_19902020 %>% 
   filter(ano_coleta>"2000" &
            ano_coleta<="2010") %>% 
   boxplot_solidos_totais(
     titulo = "Sólidos totais no período 2000-2010"
   )
)
```

```{r Gráfico SólTot periodo3, warning = FALSE, message = FALSE}
(SolTot_p3 <- plan_wide_19902020 %>% 
   filter(ano_coleta>"2010" &
            ano_coleta<="2020") %>% 
   boxplot_solidos_totais(
     titulo = "Sólidos totais no período 2010-2020"
   )
)
```

```{r Sumário Sólidos Totais, warning=FALSE, message = FALSE,}
(sum_SolTot_p1 <- plan_wide_19902020 %>%
   select(codigo, solidos_totais, ano_coleta) %>% 
   filter(ano_coleta>"1990" &
            ano_coleta<="2000") %>% 
   group_by(codigo) %>% 
   summarize(
     min = 
       min(solidos_totais, 
           na.rm = TRUE),
     q1 = 
       quantile(solidos_totais, 0.25, 
                na.rm = TRUE),
     median = 
       median(solidos_totais, 
              na.rm = TRUE),
     mean = 
       mean(solidos_totais, 
            na.rm= TRUE),
     q3 = 
       quantile(solidos_totais, 0.75, 
                na.rm = TRUE),
     max = 
       max(solidos_totais, 
           na.rm = TRUE))
)

(sum_SolTot_p2 <- plan_wide_19902020 %>%
    select(codigo, solidos_totais, ano_coleta) %>% 
    filter(ano_coleta>"2000" &
             ano_coleta<="2010") %>% 
    group_by(codigo) %>% 
    summarize(
      min = 
        min(solidos_totais, 
            na.rm = TRUE),
      q1 = 
        quantile(solidos_totais, 0.25, 
                 na.rm = TRUE),
      median = 
        median(solidos_totais, 
               na.rm = TRUE),
      mean = 
        mean(solidos_totais, 
             na.rm= TRUE),
      q3 = 
        quantile(solidos_totais, 0.75, 
                 na.rm = TRUE),
      max = 
        max(solidos_totais, 
            na.rm = TRUE))
)

(sum_SolTot_p3 <- plan_wide_19902020 %>%
    select(codigo, solidos_totais, ano_coleta) %>% 
    filter(ano_coleta>"2010" &
             ano_coleta<="2020") %>% 
    group_by(codigo) %>% 
    summarize(
      min = 
        min(solidos_totais, 
            na.rm = TRUE),
      q1 = 
        quantile(solidos_totais, 0.25, 
                 na.rm = TRUE),
      median = 
        median(solidos_totais, 
               na.rm = TRUE),
      mean = 
        mean(solidos_totais, 
             na.rm= TRUE),
      q3 = 
        quantile(solidos_totais, 0.75, 
                 na.rm = TRUE),
      max = 
        max(solidos_totais, 
            na.rm = TRUE))
)
```

```{r Salvando SolTot, warning=FALSE, message = FALSE,}
ggsave("SolTot.png",
       units = c("px"),
       width = 4500,
       height = 2993,
       plot = SolTot,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("SolTot_p1.png",
       plot = SolTot_p1,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("SolTot_p2.png",
       plot = SolTot_p2,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("SolTot_p3.png",
       plot = SolTot_p3,
       path = "./graficos",
       dpi = 300,
       type = "cairo")
```

### Condutividade elétrica

```{r Gráfico cond_elet facetted, fig.cap="condutividade-eletrica-gravataí no período 1990-2020", warning = FALSE, message = FALSE}
(cond_elet <- plan_wide_19902020 %>% 
   boxplot_cond_elet(
     titulo = "Condutividade elétrica no período 1990-2020"
   )+
   facet_wrap(~periodo)
)
```

```{r Gráfico cond_elet periodo1, warning = FALSE, message = FALSE}
(cond_elet_p1 <- plan_wide_19902020 %>% 
   filter(ano_coleta>"1990" &
            ano_coleta<="2000") %>% 
   boxplot_cond_elet(
     titulo = "Condutividade elétrica no período 1990-2000"
   )
)
```

```{r Gráfico cond_elet periodo2, warning = FALSE, message = FALSE}
(cond_elet_p2 <- plan_wide_19902020 %>% 
   filter(ano_coleta>"2000" &
            ano_coleta<="2010") %>% 
   boxplot_cond_elet(
     titulo = "Condutividade elétrica no período 2000-2010"
   )
)
```

```{r Gráfico cond_elet periodo3, warning = FALSE, message = FALSE}
(cond_elet_p3 <- plan_wide_19902020 %>% 
   filter(ano_coleta>"2010" &
            ano_coleta<="2020") %>% 
   boxplot_cond_elet(
     titulo = "Condutividade elétrica no período 2010-2020"
   )
)
```

```{r Sumário cond_elet, warning=FALSE, message = FALSE}
(sum_cond_elet_p1 <- plan_wide_19902020 %>%
   select(codigo, condutividade, ano_coleta) %>% 
   filter(ano_coleta>"1990" &
            ano_coleta<="2000") %>% 
   group_by(codigo) %>% 
   summarize(
     min = 
       min(condutividade, 
           na.rm = TRUE),
     q1 = 
       quantile(condutividade, 0.25, 
                na.rm = TRUE),
     median = 
       median(condutividade, 
              na.rm = TRUE),
     mean = 
       mean(condutividade, 
            na.rm= TRUE),
     q3 = 
       quantile(condutividade, 0.75, 
                na.rm = TRUE),
     max = 
       max(condutividade, 
           na.rm = TRUE))
)

(sum_cond_elet_p2 <- plan_wide_19902020 %>%
    select(codigo, condutividade, ano_coleta) %>% 
    filter(ano_coleta>"2000" &
             ano_coleta<="2010") %>% 
    group_by(codigo) %>% 
    summarize(
      min = 
        min(condutividade, 
            na.rm = TRUE),
      q1 = 
        quantile(condutividade, 0.25, 
                 na.rm = TRUE),
      median = 
        median(condutividade, 
               na.rm = TRUE),
      mean = 
        mean(condutividade, 
             na.rm= TRUE),
      q3 = 
        quantile(condutividade, 0.75, 
                 na.rm = TRUE),
      max = 
        max(condutividade, 
            na.rm = TRUE))
)

(sum_cond_elet_p3 <- plan_wide_19902020 %>%
    select(codigo, condutividade, ano_coleta) %>% 
    filter(ano_coleta>"2010" &
             ano_coleta<="2020") %>% 
    group_by(codigo) %>% 
    summarize(
      min = 
        min(condutividade, 
            na.rm = TRUE),
      q1 = 
        quantile(condutividade, 0.25, 
                 na.rm = TRUE),
      median = 
        median(condutividade, 
               na.rm = TRUE),
      mean = 
        mean(condutividade, 
             na.rm= TRUE),
      q3 = 
        quantile(condutividade, 0.75, 
                 na.rm = TRUE),
      max = 
        max(condutividade, 
            na.rm = TRUE),
      n = 
        length(condutividade))
)

# plan_wide_19902020 %>% 
#    select(codigo, IQA) %>% 
#    group_by(codigo) %>% 
#    summarize(
#       min = 
#          min(IQA, 
#              na.rm = TRUE),
#       q1 = 
#          quantile(IQA, 0.25, 
#                   na.rm = TRUE),
#       median = 
#          median(IQA, 
#                 na.rm = TRUE),
#       mean = 
#          mean(IQA, 
#               na.rm= TRUE),
#       q3 = 
#          quantile(IQA, 0.75, 
#                   na.rm = TRUE),
#       max = 
#          max(IQA, 
#              na.rm = TRUE))
```

```{r Salvando cond_elet, warning=FALSE, message = FALSE}
ggsave("cond_elet.png",
       units = c("px"),
       width = 4500,
       height = 2993,
       plot = cond_elet,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("cond_elet_p1.png",
       plot = cond_elet_p1,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("cond_elet_p2.png",
       plot = cond_elet_p2,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("cond_elet_p3.png",
       plot = cond_elet_p3,
       path = "./graficos",
       dpi = 300,
       type = "cairo")
```

### IQA

```{r Gráfico IQA facetted, fig.cap="iqa-gravataí no período 1990-2020", echo = FALSE, message=FALSE, warning=FALSE}
(iqa <-ggplot(plan_wide_19902020,
              aes(codigo,
                  iqa, na.rm = TRUE))+
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=-Inf,
            ymax=25,
            alpha=1,
            fill="#ac5079")+ #>pior classe
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=25,
            ymax=50,
            alpha=1,
            fill="#eb5661")+ #classe 4
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=50,
            ymax=70,
            alpha=1,
            fill="#fcf7ab")+ #classe 3
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=70,
            ymax=90,
            alpha=1,
            fill="#70c18c")+ #classe 2
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=90,
            ymax=Inf,
            alpha=1,
            fill="#8dcdeb")+ #classe 1
   stat_summary(
     fun.data = f,
     geom = 'errorbar',
     width = 0.3,
     position = position_dodge(width = 0.65),
   )+
   stat_summary(
     fun.data = f,
     geom = "boxplot",
     width = 0.7,
     fill = '#F8F8FF',
     color = "black",
     outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
   )+
   facet_wrap(~periodo)+
   labs(title = "Variação do IQA no período 1990-2020",
        x="Estação",
        y="IQA")+
   scale_y_continuous(expand = expansion(mult = c(0,0)),
                      n.breaks = 6,
                      limits = c(-1,101))+
   ggbeeswarm::geom_quasirandom(
     size = 1.2,
     alpha = .25,
     width = .07,
   )+
   scale_x_discrete(limits = c("87398500", 
                               "87398980", 
                               "87398900", 
                               "87398950", 
                               "87405500", 
                               "87406900", 
                               "87409900"),
                    labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
   )+
   geom_smooth(method = "lm",
               se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
               aes(group=1),
               alpha=.5,
               na.rm = TRUE,
               linewidth = 1)+
   theme_grafs()
   # theme(axis.title.y = element_blank())
)
```

```{r Gráfico IQA periodo1, echo = FALSE, message=FALSE, warning=FALSE}
(iqa_p1 <-ggplot(plan_wide_19902020 %>% 
                   filter(ano_coleta > "1990" &
                            ano_coleta <= "2000"),
                 aes(codigo,
                     iqa, na.rm = TRUE))+
    annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=-Inf,
            ymax=25,
            alpha=1,
            fill="#ac5079")+ #>pior classe
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=25,
            ymax=50,
            alpha=1,
            fill="#eb5661")+ #classe 4
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=50,
            ymax=70,
            alpha=1,
            fill="#fcf7ab")+ #classe 3
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=70,
            ymax=90,
            alpha=1,
            fill="#70c18c")+ #classe 2
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=90,
            ymax=Inf,
            alpha=1,
            fill="#8dcdeb")+ #classe 1
    stat_boxplot(geom = 'errorbar',
                 width=0.3,
                 position = position_dodge(width = 0.65),
                 na.rm = TRUE)+
    geom_boxplot(fill='#F8F8FF',
                 color="black",
                 outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
                 width= 0.7,
                 na.rm = TRUE)+
    labs(title = "Variação do IQA no período 1990-2000",
         x="Estação",
         y="")+
    scale_y_continuous(expand = expansion(mult = c(0,0)),
                       n.breaks = 6,
                       limits = c(-1,101))+
    ggbeeswarm::geom_quasirandom(
     size = 1.2,
     alpha = .25,
     width = .07,
   )+
   scale_x_discrete(limits = c("87398500", 
                               "87398980", 
                               "87398900", 
                               "87398950", 
                               "87405500", 
                               "87406900", 
                               "87409900"),
                    labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
   )+
    geom_smooth(method = "lm",
                se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
                aes(group=1),
                alpha=.5,
                na.rm = TRUE,
                linewidth = 1)+
   theme_grafs()+
   theme(axis.title.y = element_blank())
)
```

```{r Gráfico IQA periodo2, echo = FALSE, message=FALSE, warning=FALSE}
(iqa_p2 <-ggplot(plan_wide_19902020 %>% 
                   filter(ano_coleta > "2000" &
                            ano_coleta <= "2010"),
                 aes(codigo,
                     iqa, na.rm = TRUE))+
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=-Inf,
            ymax=25,
            alpha=1,
            fill="#ac5079")+ #>pior classe
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=25,
            ymax=50,
            alpha=1,
            fill="#eb5661")+ #classe 4
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=50,
            ymax=70,
            alpha=1,
            fill="#fcf7ab")+ #classe 3
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=70,
            ymax=90,
            alpha=1,
            fill="#70c18c")+ #classe 2
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=90,
            ymax=Inf,
            alpha=1,
            fill="#8dcdeb")+ #classe 1
   stat_boxplot(geom = 'errorbar',
                width=0.3,
                position = position_dodge(width = 0.65),
                na.rm = TRUE)+
   geom_boxplot(fill='#F8F8FF',
                color="black",
                outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
                width= 0.7,
                na.rm = TRUE)+
   labs(title = "Variação do IQA no período 2000-2010",
        x="Estação",
        y="")+
   scale_y_continuous(expand = expansion(mult = c(0,0)),
                      n.breaks = 6,
                      limits = c(-1,101))+
   ggbeeswarm::geom_quasirandom(
     size = 1.2,
     alpha = .25,
     width = .07,
   )+
   scale_x_discrete(limits = c("87398500", 
                               "87398980", 
                               "87398900", 
                               "87398950", 
                               "87405500", 
                               "87406900", 
                               "87409900"),
                    labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
   )+
   geom_smooth(method = "lm",
               se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
               aes(group=1),
               alpha=.5,
               na.rm = TRUE,
               linewidth = 1)+
 theme_grafs()+
   theme(axis.title.y = element_blank()
   )
)
```

```{r Gráfico IQA periodo3, echo = FALSE, message=FALSE, warning=FALSE}
(iqa_p3 <-ggplot(plan_wide_19902020 %>% 
                   filter(ano_coleta > "2010" &
                            ano_coleta <= "2020"),
                 aes(codigo,
                     iqa, na.rm = TRUE))+
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=-Inf,
            ymax=25,
            alpha=1,
            fill="#ac5079")+ #>pior classe
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=25,
            ymax=50,
            alpha=1,
            fill="#eb5661")+ #classe 4
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=50,
            ymax=70,
            alpha=1,
            fill="#fcf7ab")+ #classe 3
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=70,
            ymax=90,
            alpha=1,
            fill="#70c18c")+ #classe 2
   annotate("rect",
            xmin=-Inf,
            xmax=Inf,
            ymin=90,
            ymax=Inf,
            alpha=1,
            fill="#8dcdeb")+ #classe 1
   stat_boxplot(geom = 'errorbar',
                width=0.3,
                position = position_dodge(width = 0.65),
                na.rm = TRUE)+
   geom_boxplot(fill='#F8F8FF',
                color="black",
                outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
                width= 0.7,
                na.rm = TRUE)+
   labs(title = "Variação do IQA no período 2010-2020",
        x="Estação",
        y="")+
   scale_y_continuous(expand = expansion(mult = c(0,0)),
                      n.breaks = 6,
                      limits = c(-1,101))+
   ggbeeswarm::geom_quasirandom(
     size = 1.2,
     alpha = .25,
     width = .07,
   )+
   scale_x_discrete(limits = c("87398500", 
                               "87398980", 
                               "87398900", 
                               "87398950", 
                               "87405500", 
                               "87406900", 
                               "87409900"),
                    labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
   )+
   geom_smooth(method = "lm",
               se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
               aes(group=1),
               alpha=.5,
               na.rm = TRUE,
               linewidth = 1)+
    theme_grafs()+
    theme(axis.title.y = element_blank())
)
```

```{r Sumário IQA, warning=FALSE, message = FALSE,}
(sum_IQA_p1 <- plan_wide_19902020 %>%
   select(codigo, iqa, ano_coleta) %>% 
   filter(ano_coleta>"1990" &
            ano_coleta<="2000") %>% 
   group_by(codigo) %>% 
   summarize(
     min = 
       min(iqa, 
           na.rm = TRUE),
     q1 = 
       quantile(iqa, 0.25, 
                na.rm = TRUE),
     median = 
       median(iqa, 
              na.rm = TRUE),
     mean = 
       mean(iqa, 
            na.rm= TRUE),
     q3 = 
       quantile(iqa, 0.75, 
                na.rm = TRUE),
     max = 
       max(iqa, 
           na.rm = TRUE),
     n = 
        length(iqa)
   )
)

(sum_IQA_p2 <- plan_wide_19902020 %>%
    select(codigo, iqa, ano_coleta) %>% 
    filter(ano_coleta>"2000" &
             ano_coleta<="2010") %>% 
    group_by(codigo) %>% 
    summarize(
      min = 
        min(iqa, 
            na.rm = TRUE),
      q1 = 
        quantile(iqa, 0.25, 
                 na.rm = TRUE),
      median = 
        median(iqa, 
               na.rm = TRUE),
      mean = 
        mean(iqa, 
             na.rm= TRUE),
      q3 = 
        quantile(iqa, 0.75, 
                 na.rm = TRUE),
      max = 
        max(iqa, 
            na.rm = TRUE),
      n = 
        length(iqa)
      )
)

(sum_IQA_p3 <- plan_wide_19902020 %>%
    select(codigo, iqa, ano_coleta) %>% 
    filter(ano_coleta>"2010" &
             ano_coleta<="2020") %>%
    # ?as_factor(codigo) %>% 
    group_by(codigo) %>%
    summarize(
      min = 
        min(iqa, 
            na.rm = TRUE),
      q1 = 
        quantile(iqa, 0.25, 
                 na.rm = TRUE),
      median = 
        median(iqa, 
               na.rm = TRUE),
      mean = 
        mean(iqa, 
             na.rm= TRUE),
      q3 = 
        quantile(iqa, 0.75, 
                 na.rm = TRUE),
      max = 
        max(iqa, 
            na.rm = TRUE),
      n = 
        length(iqa),
      NAs = 
        sum(is.na(iqa))
      ) %>% 
  mutate(
    "%NA" = NAs/n*100
  )
)

```

```{r Salvando iqa, warning=FALSE, message = FALSE,}
ggsave("iqa.png",
       units = c("px"),
       width = 4500,
       height = 2993,
       plot = iqa,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("iqa_p1.png",
       plot = iqa_p1,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("iqa_p2.png",
       plot = iqa_p2,
       path = "./graficos",
       dpi = 300,
       type = "cairo")

ggsave("iqa_p3.png",
       plot = iqa_p3,
       path = "./graficos",
       dpi = 300,
       type = "cairo")
```

## Testando coisas

```{r Testando coisas, include = FALSE, warning=FALSE, message = FALSE,}
# plan_wide_19902020 %>% 
#    select(codigo, oxigenio_dissolvido, ano_coleta) %>% 
#    ggplot(aes(ano_coleta, oxigenio_dissolvido, 
#       col = codigo))+
#    geom_line()+
#    facet_wrap(~ codigo, ncol = 7)

# df111 <- data.frame(x = c(1:100))
# glimpse(df111)
# df111$y <- 2 + 3 * df111$x + rnorm(100, sd = 40)
# 
# lm_eqn <- function(df111){
#     m <- lm(y ~ x, df111);
#     eq <- substitute(y == a + b %.% x*","~~r^2~"="~r2,
#          list(a = format(unname(coef(m)[1]), digits = 2),
#               b = format(unname(coef(m)[2]), digits = 2),
#              r2 = format(summary(m)$r.squared, digits = 3)))
#     as.character(as.expression(eq));
# } 
# p2 <- p111 +
#   geom_text(x = 25, y = 300,
#             label = lm_eqn(df111),
#             parse = TRUE)
# p2
# 
# 
# lm_eqc <- function(plan_wide_19902020){
#    m <- lm(oxigenio_dissolvido ~ codigo, plan_wide_19902020);
#    eq <- substitute(y == a + b %.% x*","~~r^2~"="~r2,
#                     list(a = format(unname(coef(m)[1]), digits = 2),
#                          b = format(unname(coef(m)[2]), digits = 2),
#                          r2 = format(summary(m)$r.squared, digits = 3)))
#    as.character(as.expression(eq));
# }
# 
# (od_p1 <-ggplot(plan_wide_19902020 %>%
#                    filter(ano_coleta>"1990" &
#                              ano_coleta<="2000"),
#                 aes(codigo,
#                     oxigenio_dissolvido))+
#       annotate("rect",
#                xmin=-Inf,
#                xmax=Inf,
#                ymin=-Inf,
#                ymax=2,
#                alpha=1,
#                fill="#ac5079")+ #>pior classe
#       annotate("rect",
#                xmin=-Inf,
#                xmax=Inf,
#                ymin=2,
#                ymax=4,
#                alpha=1,
#                fill="#eb5661")+ #classe 4
#       annotate("rect",
#                xmin=-Inf,
#                xmax=Inf,
#                ymin=4,
#                ymax=5,
#                alpha=1,
#                fill="#fcf7ab")+ #classe 3
#       annotate("rect",
#                xmin=-Inf,
#                xmax=Inf,
#                ymin=5,
#                ymax=6,
#                alpha=1,
#                fill="#70c18c")+ #classe 2
#       annotate("rect",
#                xmin=-Inf,
#                xmax=Inf,
#                ymin=6,
#                ymax=Inf,
#                alpha=1,
#                fill="#8dcdeb")+ #classe 1
#       stat_boxplot(geom = 'errorbar',
#                    width=0.3,
#                    position = position_dodge(width = 0.65))+
#       geom_boxplot(fill='#F8F8FF',
#                    color="black",
#                    outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
#                    width= 0.7)+
#       labs(title = "Oxigênio Dissolvido no período 1990-2000",
#            x="Estação",
#            y="mg/L")+
#       # geom_jitter(width = .05,
#       #             alpha=.2,
#       #             size=1.5,
#       #             color="black")+
#       scale_y_continuous(expand = expansion(mult = c(0,0)),
#                          n.breaks = 11,
#                          limits = c(-1,21))+
#       scale_x_discrete(limits = c("87398500", "87398980", "87398900", "87398950", "87405500", "87406900", "87409900"))+
#       geom_smooth(method = "lm",
#                   se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
#                   aes(group=1),
#                   alpha=.5,
#                   na.rm = TRUE,
#                   linewidth = 1)+
#       # annotate(geom_text(aes(x = "87405500", y = 15),
#       #                    label = lm_eqc(plan_wide_19902020),
#       #                    parse = TRUE,
#       #                    inherit.aes = TRUE,
#       #                    check_overlap = TRUE))+
#       #  geom_line(
#       #     aes(color="red"),
#       #     alpha=.0,
#       # )+
#       # scale_color_manual("Legenda",
#       #                    guide="legend",
#       #                    values = c("Classe 1"="#8dcdeb",
#       #                               "Classe 2"="#70c18c",
#       #                               "Classe 3"="#fcf7ab",
#       #                               "Classe 4"="#eb5661",
#       #                               "Pior Classe"="#ac5079"))+
#    # guides(color=guide_legend(override.aes = list(linetype=c(1,1,1,1,1),
#    #                                               lwd=c(2,2,2,2,2),
#    #                                               shape=c(NA,NA,NA,NA,NA),
#    #                                               alpha=1)))+
#       theme(legend.position = "bottom")+
#       theme_classic())

# list1111 <- sessionInfo()
# list1111$loadedOnly

# install.packages("ggpmisc")
# library(ggpmisc)

# summary(lm(plan_wide_19902020$codigo~plan_wide_19902020$dbo))
# 
# 
# p <- ggplot(data, aes(y=number, x=pod)) +
#   geom_boxplot()
# print(p)

# install.packages("GGally")


# fit = lm(plan_wide_19902020$oxigenio_dissolvido~ plan_wide_19902020$codigo)
# summary(fit)
# summary.lm(fit)
# 
# pacman::p_load(esquisse)

# sumario <- function(x, y){
#   x %>% 
#     group_by(codigo) %>%
#     summarise(
#       list(min= ~min(y, na.rm = TRUE), 
#            Q1= ~quantile(y, probs = 0.25),
#            median= ~median(y, na.rm = TRUE), 
#            Q3= ~quantile(y, probs = 0.75),
#            max= ~max(y, na.rm = TRUE)),
#       .groups = "drop"
#       )
# }
```

## Correlação

```{r Correlação, fig.cap="correlação-parametros-qualidade-agua-gravataí no período 1990-2020", time_it = TRUE, warning=FALSE, message = FALSE,}
parametros_IQA %>% 
  dplyr::select(
    -codigo,
    -ano_coleta,
    -nitrogenio_total
    ) %>% 
  # group_by(codigo) %>% 
  rename(
    CE = condutividade,
    E_coli = escherichia_coli,
    OD = oxigenio_dissolvido,
    ST = solidos_totais,
    Turb = turbidez,
    Temp = temperatura_agua,
    Ptot = fosforo_total,
    # NTot = nitrogenio_total,
    NAmon = nitrogenio_amoniacal,
    NTK = nitrogenio_kjeldahl
  ) %>% 
  ggcorr(
    method = "complete.obs",
    # "pearson",
    # "pairwise",
    name = "Correlação",
    label = TRUE,
    label_alpha = TRUE,
    digits = 3,
    low = "#3B9AB2",
    mid = "#EEEEEE",
    high = "#F21A00",
    # palette = "RdYlBu",
    layout.exp = 0,
    legend.position = "left",
    label_round = 3,
    # legend.size = 18,
    geom = "tile",
    nbreaks = 10,
  )+
  labs(title = "Correlação entre parâmetros físico-químicos na\nBacia Hidrográfica do rio Gravataí no período 1990-2020")+
  theme_linedraw()+
  theme(
    legend.position = c(0.15, 0.6),
    legend.title = element_text(size = 16),
    legend.text = element_text(size = 14),
    # legend.spacing = unit(element_text(),
                          # units = 5)
    plot.title = element_text(hjust = 0.5,
                              size = 16)
  )

# Gráfico das correlações entre todos os parâmetros com significância
correl_IQA <- parametros_IQA %>%
  dplyr::select(-codigo) %>%
  ggpairs(title = "Correlação entre parâmetros que compõem o IQA",
          axisLabels = "show")

correlacao_pIQA <- parametros_IQA %>% 
  group_by(codigo) %>% 
  correlation::correlation()

correlacao_pIQA %>% 
  # glimpse()
  filter(
    p < 0.001
  ) %>% 
  as_tibble() %>% 
  # filter(
  #   Parameter1 == "oxigenio_dissolvido"
  # ) %>% 
  arrange(desc(r)) 
  
parametros_IQA %>% 
  # group_by(codigo) %>% 
  dplyr::select(
    nitrogenio_kjeldahl, condutividade
  ) %>% 
  # correlation::cor_test() %>% 
  plot()
```

# EDA

```{r}
eda_all_time <- plan_wide_19902020 %>% 
  select(
    oxigenio_dissolvido, 
    dbo, 
    fosforo_total, 
    solidos_totais, 
    escherichia_coli, 
    nitrogenio_amoniacal, 
    temperatura_agua, 
    turbidez, 
    pH, 
    condutividade, 
    periodo
  ) %>% 
  skimr::skim() %>% 
  arrange(
    desc(complete_rate)
  )
```

# Textando o texto

-   § falar do comportamento geral dos dados
-   2º § - xº § -\> abordar os principais parâmetros que estão sendo impactados, detalhando, nas estações mais relevantes, como ficaram os quartis/mediana etc.

`r sum_od_p1$PM1[1]`

<!--# ainda falta ajustar a formatação das casas decimais. talvez fazer um =left() e =right(), que nem no excel -->

Dentre os parâmetros selecionados para a análise, todos, com exceção ao nitrogênio amoniacal, possuíram mais que 85% das amostras com valores medidos. O nitrogênio amoniacal teve `r eda_all_time %>% filter(skim_variable == "nitrogenio_amoniacal") %>% .[4] %>% pluck(1) %>% percent()` dos valores medidos com `r eda_all_time %>% filter(skim_variable == "nitrogenio_amoniacal") %>% .[3] %>% pluck(1)` dados faltantes, dos 1.179 totais. A temperatura da água foi o parâmetro mais completo, com `r eda_all_time %>% filter(skim_variable == "temperatura_agua") %>% .[4] %>% pluck(1) %>% percent()` das medições e apenas `r eda_all_time %>% filter(skim_variable == "temperatura_agua") %>% .[3] %>% pluck(1)` dados faltantes.

Os resultados apontam que há uma queda na qualidade da água no sentido montante-jusante para os parâmetros OD, DBO, Fósforo total, Nitrogênio amoniacal e condutividade elétrica. A *E. coli* teve, durante a primeira década, melhora da qualidade ao longo do rio, contudo, houve uma reversão na tendência para os dois períodos subsequentes.

A turbidez registrou, ao sumarizar a série por período, valores médios de `r plan_wide_19902020 %>% group_by(periodo) %>% select(turbidez, periodo) %>% skim() %>% select(-numeric.hist) %>% .[1,6] %>% pluck(1) %>% formattable(digits = 3, format = "f")`, `r plan_wide_19902020 %>% group_by(periodo) %>% select(turbidez, periodo) %>% skim() %>% select(-numeric.hist) %>% .[2,6] %>% pluck(1) %>% formattable(digits = 3, format = "f")` e `r plan_wide_19902020 %>% group_by(periodo) %>% select(turbidez, periodo) %>% skim() %>% select(-numeric.hist) %>% .[3,6] %>% pluck(1) %>% formatC(digits = 3, format = "f")` UNT, respectivamente.


# Discussão

A redução dos valores de turbidez no período 2010-2020 ocorreu por conta de ações tomadas pelo setor público: Fepam, Brigada ambiental. [^1]

[^1]: Inserir referência.

# Gráficos exemplos boxplot

```{r elementos do boxplot}
set.seed(2023)
exemplo_boxplot_df <- data.frame(
  PM = c("PM1"),
  # letras = letters[seq( from = 1, to = 1 )],
  Stat1 = rnorm(100, 
                mean = 5, 
                sd = 1.8)
)

(sumario_exemplo_bp <- exemplo_boxplot_df %>% 
    group_by(PM) %>% 
    summarize(
      max = max(Stat1),
      p95 = quantile(Stat1, 0.95),
      p80 = quantile(Stat1, 0.8),
      median = median(Stat1),
      p20 = quantile(Stat1, 0.2),
      p05 = quantile(Stat1, 0.05),
      min = min(Stat1),
    ) %>% 
    t() %>% 
    row_to_names(row_number = 1) %>% 
    as.numeric()
)


(boxplot_example <- exemplo_boxplot_df %>% 
    ggplot(
      aes(
        x = PM,
        y = Stat1,
      )
    )+
    stat_summary(
      fun.data = f,
      geom = 'errorbar',
      width = 0.15,
      position = position_dodge(width = 0.65),
    )+
    stat_summary(
      fun.data = f,
      geom = "boxplot",
      width = 0.40,
      fill = '#F8F8FF',
      color = "black",
      outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
    )+
    labs(
      title = "Elementos do *boxplot*",
      x= NULL,
      y= NULL
    )+
    ggbeeswarm::geom_quasirandom(
      size = 1.4,
      alpha = .3,
      width = .07,
    )+
    scale_y_continuous(
      expand = expansion(mult = c(0,0)),
      n.breaks = 8,
      limits = c(-0.3,12)
    )+
    annotate(
      geom = "text",
      x = 1.55,
      hjust = "right",
      y = sumario_exemplo_bp,
      label = c("Valor máximo", "P95", "P80", "Mediana", "P20", "P05", "Valor mínimo"),
      # fontface = 3
    )+
    geom_richtext(
      x = 0.56,
      y = 9.103998,
      label.color = NA,
      hjust = "center",
      label = "<i>Outliers</i>"
    )+
    geom_curve(
      aes(
        x = 0.6, xend = 0.98,
        y = 9.103998 , yend = 9.103998 , #Outliers
      ),
      curvature = 0,
      size = 1.0,
      arrow = arrow(length = unit(0.05, "npc")),
      lineend = "round"
    )+
    #definindo o [
    geom_curve(
      aes(
        x = 0.74, xend = 0.78,
        y = 6.683828, yend = 6.683828,
      ),
      curvature = 0,
      size = 1.0,
      lineend = "butt"
    )+
    geom_curve(
      aes(
        x = 0.74, xend = 0.74,
        y = 3.545771, yend = 6.683828,
      ),
      curvature = 0,
      size = 1.0,
      lineend = "butt"
    )+
    annotate(
      geom = "text",
      x = 0.56,
      hjust = "center",
      y = 5.11,
      label = "Amplitude\n(P80-P20)"
    )+
    geom_curve(
      aes(
        x = 0.74, xend = 0.78,
        y = 3.545771 , yend = 3.545771 ,
      ),
      curvature = 0,
      size = 1.0,
      lineend = "butt"
    )+
    # fim do [
    geom_curve(
      aes(
        x = 0.6, xend = 0.90,
        y = 7.866927 , yend = 7.866927 , #whisker superior
      ),
      curvature = 0,
      size = 1.0,
      arrow = arrow(length = unit(0.05, "npc")),
      lineend = "round"
    )+
    annotate(
      geom = "text",
      x = 0.56,
      hjust = "center",
      y = 7.866927,
      label = "Whisker\nsuperior"
    )+
    geom_curve(
      aes(
        x = 0.6, xend = 0.90,
        y = 2.277104  , yend = 2.277104  , #whisker inferior
      ),
      curvature = 0,
      size = 1.0,
      arrow = arrow(length = unit(0.05, "npc")),
      lineend = "round"
    )+
    annotate(
      geom = "text",
      x = 0.56,
      hjust = "center",
      y = 2.277104,
      label = "Whisker\ninferior"
    )+
    geom_curve(
      aes(
        x = 1.4, xend = 1.01,
        y = 9.92343, yend = 9.92343, #valor máximo
      ),
      curvature = 0,
      size = 1.0,
      arrow = arrow(length = unit(0.05, "npc")),
      lineend = "round"
    )+
    geom_curve(
      aes(
        x = 1.45, xend = 1.11,
        y = 7.866927 , yend = 7.866927 , #P95
      ),
      curvature = 0,
      size = 1.0,
      arrow = arrow(length = unit(0.05, "npc")),
      lineend = "round"
    )+
    geom_curve(
      aes(
        x = 1.45, xend = 1.22,
        y = 6.683828  , yend = 6.683828  , #P80
      ),
      curvature = 0,
      size = 1.0,
      arrow = arrow(length = unit(0.05, "npc")),
      lineend = "round"
    )+
    geom_curve(
      aes(
        x = 1.45, xend = 1.22,
        y = 4.886935   , yend = 4.886935   , #P50
      ),
      curvature = 0,
      size = 1.0,
      arrow = arrow(length = unit(0.05, "npc")),
      lineend = "round"
    )+
    geom_curve(
      aes(
        x = 1.45, xend = 1.22,
        y = 3.545771, yend = 3.545771, #P20
      ),
      curvature = 0,
      size = 1.0,
      arrow = arrow(length = unit(0.05, "npc")),
      lineend = "round"
    )+
    geom_curve(
      aes(
        x = 1.45, xend = 1.11,
        y = 2.277104, yend = 2.277104, #P05
      ),
      curvature = 0,
      size = 1.0,
      arrow = arrow(length = unit(0.05, "npc")),
      lineend = "round"
    )+
    geom_curve(
      aes(
        x = 1.4, xend = 1.01,
        y = 1.282177, yend = 1.282177, #valor mínimo
      ),
      curvature = 0,
      size = 1.0,
      arrow = arrow(length = unit(0.05, "npc")),
      lineend = "round"
    )+
    # theme_grafs()+
    theme_bw()+
    theme(
      plot.title = 
        element_markdown(
          hjust = 0.5,
          color = "black",
          size = 19),
    )
)
```

```{r salvando graf elementos boxplot}
ggsave(
  filename = "exemplo_boxplot.png",
  plot = boxplot_example,
  units = c("px"),
  width = (4500)/1.5,
  height = (2993)/1.5,
  path = "./graficos",
  dpi = 300,
  # type = "cairo"
)
```

```{r criando exemplo tipos boxplot tukey x garrett}
set.seed(2021)

data <- tibble(
  grupo = factor(
    c(rep(
      "Grupo 1", 100), 
      rep("Grupo 2", 250), 
      rep("Grupo 3", 25)
    )
  ),
  valor = c(seq(0, 20, length.out = 100),
            c(rep(0, 5), 
              rnorm(30, 2, .1), 
              rnorm(90, 5.4, .1), 
              rnorm(90, 14.6, .1), 
              rnorm(30, 18, .1), 
              rep(20, 5)
            ),
            rep(seq(0, 20, length.out = 5), 5))
) %>% 
  rowwise() %>%
  mutate(
    valor = if_else(
      grupo == "Grupo 2", valor + rnorm(1, 0, .4), 
      valor
      )
    )

## function to return median and labels
n_fun <- function(x){
  return(
    data.frame(
      y = median(x) - 1.25, 
      label = paste0(
        "n = ",length(x)
      )
    )
  )
}
```

```{r tukey boxplot}
(tukey_n_boxplot <- ggplot(data, 
                           aes(x = grupo, 
                               y = valor)
)+
  stat_boxplot(geom = 'errorbar',
               width = 0.15,
               position = position_dodge(width = 0.65))+
  geom_boxplot(fill = "grey92",
               width = 0.40,
               position = position_dodge(width = 0.65))+
  ## use summary function to add text labels
  stat_summary(
    geom = "text",
    fun.data = n_fun,
    # family = "Oswald",
    size = 5
  )+
  labs(
    title = "Tukey *boxplot*",
    x= NULL,
    # y="mg/L"
  )+
  # theme_grafs()+
  theme_bw()+
  theme(
    axis.text.y = element_text(
      angle = 90, 
      # size=15,
      # face=2
    ),
    plot.title = 
      element_markdown(
        hjust = 0.5,
        color = "black",
        size = 19)
  )
)


(tukey_boxplot <- ggplot(data, aes(x = grupo, 
                                   y = valor)) +
  stat_boxplot(geom = 'errorbar',
               width = 0.15,
               position = position_dodge(width = 0.65))+
  geom_boxplot(fill = "grey92",
               width = 0.40,
               position = position_dodge(width = 0.65)) +
  ## use either geom_point() or geom_jitter()
  geom_point(
    ## draw bigger points
    size = 2,
    ## add some transparency
    alpha = .25,
    ## add some jittering
    position = position_jitter(
      ## control randomness and range of jitter
      seed = 1, width = .2
    )
  )+
  theme_bw()+
  labs(
      title = "Tukey *boxplot*",
      x= NULL,
      # y="mg/L"
    )+
  # theme_grafs()+
  theme_bw()+
  theme(
        axis.text.y = element_text(
          angle = 90, 
          # size=15,
          # face=2
        ),
        plot.title = 
          element_markdown(
            hjust = 0.5,
            color = "black",
            size = 19)
    ))
```

```{r garrett boxplot}
data %>% 
  group_by(grupo) %>% 
  summarize(
    min = min(valor),
    P20 = quantile(valor, 0.20),
    q1 = quantile(valor, 0.25),
    mediana = median(valor),
    q3 = quantile(valor, 0.75),
    P80 = quantile(valor, 0.80),
    max = max(valor)
  ) %>% 
  t() %>% 
  row_to_names(row_number = 1)
  
  
(box_percentile_plot <- ggplot(data, 
       aes(x = grupo, y = valor)
       ) +
      stat_summary(
        fun.data = f,
        geom = 'errorbar',
        width = 0.15,
        position = position_dodge(width = 0.65),
      )+
      stat_summary(
        fun.data = f,
        geom = "boxplot",
        width = 0.40,
        fill = 'grey92',
        color = "black",
        outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
      )+
  # geom_boxplot(fill = "grey92") +
  ## use either geom_point() or geom_jitter()
  geom_point(
    ## draw bigger points
    size = 2,
    ## add some transparency
    alpha = .25,
    ## add some jittering
    position = position_jitter(
      ## control randomness and range of jitter
      seed = 1, width = .2
    )
  )+
  labs(
      title = "*Box Percentile-Plot*",
      x= NULL,
      # y="mg/L"
    )+
  # theme_grafs()+
  theme_bw()+
  theme(
        axis.text.y = element_text(
          angle = 90, 
          # size = 15,
          # face = 2
        ),
        plot.title = 
          element_markdown(
            hjust = 0.5,
            color = "black",
            size = 19)
    )
  )
grid.arrange(
  tukey_boxplot, box_percentile_plot, 
  ncol = 2
  )
fig_tukey_garrett <- plot_grid(tukey_boxplot, box_percentile_plot,
                               labels = "AUTO")
```

```{r salvando graf exemplo boxplot}
ggsave(
  filename = "tukey_n_boxplot.png",
  plot = tukey_n_boxplot,
  units = c("px"),
  width = 4500,
  height = 2993,
  path = "./graficos",
  dpi = 300,
  # type = "cairo"
)

ggsave(
  filename = "tukey_boxplot.png",
  plot = tukey_boxplot,
  units = c("px"),
  width = 4500,
  height = 2993,
  path = "./graficos",
  dpi = 300,
  # type = "cairo"
)

ggsave(
  filename = "box_percentile_plot.png",
  plot = box_percentile_plot,
  units = c("px"),
  width = 4500,
  height = 2993,
  path = "./graficos",
  dpi = 300,
  # type = "cairo"
)

ggsave(
  filename = "fig_tukey_garrett.png",
  plot = fig_tukey_garrett,
  units = c("px"),
  width = 4500,
  height = 2993,
  path = "./graficos",
  dpi = 300,
  # type = "cairo"
)
```
