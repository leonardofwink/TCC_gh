#   width = 0.7
# )+
geom_boxplot(
fill = '#F8F8FF',
color = "black",
outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
width = 0.7
)+
facet_wrap(~periodo)+
labs(
title = "Oxigênio Dissolvido no período 1990-2020",
x= NULL,
y="mg/L"
)+
ggbeeswarm::geom_quasirandom(
size = 1.2,
alpha = .25,
width = .07,
)+
scale_y_continuous(
expand = expansion(mult = c(0,0)),
n.breaks = 11,
limits = c(-0.3,21)
)+
scale_x_discrete(limits = c("87398500",
"87398980",
"87398900",
"87398950",
"87405500",
"87406900",
"87409900"),
labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
)+
# scale_fill_brewer(palette = "Set1")+
scale_color_manual(name = "Período",
breaks = c("p1", "p2", "p3"),
values = c("black", "#303030", "#696969"),
labels = c("1990-2000", "2000-2010", "2010-2020")
)+
geom_smooth(
method = "lm",
se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
aes(group = 1),
alpha = .5,
na.rm = TRUE,
size = 1
)+
theme_grafs()
)
original.function <- environment(ggplot2::StatBoxplot$compute_group)$f
(od <- plan_wide_19902020 %>%
ggplot(
aes(
x = CODIGO,
y = Oxigenio_dissolvido,
group = CODIGO
# color = periodo,
# fill = periodo
)
)+
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = -Inf, ymax = 2,
alpha = 1,
fill = "#ac5079")+ #>pior classe
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = 2, ymax = 4,
alpha = 1,
fill = "#eb5661")+ #classe 4
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = 4, ymax = 5,
alpha = 1,
fill = "#fcf7ab")+ #classe 3
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = 5, ymax = 6,
alpha = 1,
fill = "#70c18c")+ #classe 2
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin= 6, ymax = Inf,
alpha = 1,
fill = "#8dcdeb")+ #classe 1
# stat_summary(
#   aes(),
#   fun
# )
stat_boxplot(
geom = 'errorbar',
width = 0.3,
position = position_dodge(width = 0.65)
)+
# stat_summary(
#   fun.data = f,
#   geom = "boxplot",
#   fill = '#F8F8FF',
#   width = 0.7
# )+
geom_boxplot(
fill = '#F8F8FF',
color = "black",
outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
width = 0.7
)+
facet_wrap(~periodo)+
labs(
title = "Oxigênio Dissolvido no período 1990-2020",
x= NULL,
y="mg/L"
)+
ggbeeswarm::geom_quasirandom(
size = 1.2,
alpha = .25,
width = .07,
)+
scale_y_continuous(
expand = expansion(mult = c(0,0)),
n.breaks = 11,
limits = c(-0.3,21)
)+
scale_x_discrete(limits = c("87398500",
"87398980",
"87398900",
"87398950",
"87405500",
"87406900",
"87409900"),
labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
)+
# scale_fill_brewer(palette = "Set1")+
scale_color_manual(name = "Período",
breaks = c("p1", "p2", "p3"),
values = c("black", "#303030", "#696969"),
labels = c("1990-2000", "2000-2010", "2010-2020")
)+
geom_smooth(
method = "lm",
se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
aes(group = 1),
alpha = .5,
na.rm = TRUE,
size = 1
)+
theme_grafs()
)
environment(StatBoxplot$compute_group)$f <- original.function
(od <- plan_wide_19902020 %>%
ggplot(
aes(
x = CODIGO,
y = Oxigenio_dissolvido,
group = CODIGO
# color = periodo,
# fill = periodo
)
)+
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = -Inf, ymax = 2,
alpha = 1,
fill = "#ac5079")+ #>pior classe
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = 2, ymax = 4,
alpha = 1,
fill = "#eb5661")+ #classe 4
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = 4, ymax = 5,
alpha = 1,
fill = "#fcf7ab")+ #classe 3
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = 5, ymax = 6,
alpha = 1,
fill = "#70c18c")+ #classe 2
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin= 6, ymax = Inf,
alpha = 1,
fill = "#8dcdeb")+ #classe 1
# stat_summary(
#   aes(),
#   fun
# )
stat_boxplot(
geom = 'errorbar',
width = 0.3,
position = position_dodge(width = 0.65)
)+
# stat_summary(
#   fun.data = f,
#   geom = "boxplot",
#   fill = '#F8F8FF',
#   width = 0.7
# )+
geom_boxplot(
fill = '#F8F8FF',
color = "black",
outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
width = 0.7
)+
facet_wrap(~periodo)+
labs(
title = "Oxigênio Dissolvido no período 1990-2020",
x= NULL,
y="mg/L"
)+
ggbeeswarm::geom_quasirandom(
size = 1.2,
alpha = .25,
width = .07,
)+
scale_y_continuous(
expand = expansion(mult = c(0,0)),
n.breaks = 11,
limits = c(-0.3,21)
)+
scale_x_discrete(limits = c("87398500",
"87398980",
"87398900",
"87398950",
"87405500",
"87406900",
"87409900"),
labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
)+
# scale_fill_brewer(palette = "Set1")+
scale_color_manual(name = "Período",
breaks = c("p1", "p2", "p3"),
values = c("black", "#303030", "#696969"),
labels = c("1990-2000", "2000-2010", "2010-2020")
)+
geom_smooth(
method = "lm",
se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
aes(group = 1),
alpha = .5,
na.rm = TRUE,
size = 1
)+
theme_grafs()
)
original.function <- environment(ggplot2::StatBoxplot$compute_group)$f
environment(StatBoxplot$compute_group)$f <- original.function
(od <- plan_wide_19902020 %>%
ggplot(
aes(
x = CODIGO,
y = Oxigenio_dissolvido,
group = CODIGO
# color = periodo,
# fill = periodo
)
)+
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = -Inf, ymax = 2,
alpha = 1,
fill = "#ac5079")+ #>pior classe
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = 2, ymax = 4,
alpha = 1,
fill = "#eb5661")+ #classe 4
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = 4, ymax = 5,
alpha = 1,
fill = "#fcf7ab")+ #classe 3
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = 5, ymax = 6,
alpha = 1,
fill = "#70c18c")+ #classe 2
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin= 6, ymax = Inf,
alpha = 1,
fill = "#8dcdeb")+ #classe 1
# stat_summary(
#   aes(),
#   fun
# )
stat_boxplot(
geom = 'errorbar',
width = 0.3,
position = position_dodge(width = 0.65)
)+
# stat_summary(
#   fun.data = f,
#   geom = "boxplot",
#   fill = '#F8F8FF',
#   width = 0.7
# )+
geom_boxplot(
fill = '#F8F8FF',
color = "black",
outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
width = 0.7
)+
facet_wrap(~periodo)+
labs(
title = "Oxigênio Dissolvido no período 1990-2020",
x= NULL,
y="mg/L"
)+
ggbeeswarm::geom_quasirandom(
size = 1.2,
alpha = .25,
width = .07,
)+
scale_y_continuous(
expand = expansion(mult = c(0,0)),
n.breaks = 11,
limits = c(-0.3,21)
)+
scale_x_discrete(limits = c("87398500",
"87398980",
"87398900",
"87398950",
"87405500",
"87406900",
"87409900"),
labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
)+
# scale_fill_brewer(palette = "Set1")+
scale_color_manual(name = "Período",
breaks = c("p1", "p2", "p3"),
values = c("black", "#303030", "#696969"),
labels = c("1990-2000", "2000-2010", "2010-2020")
)+
geom_smooth(
method = "lm",
se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
aes(group = 1),
alpha = .5,
na.rm = TRUE,
size = 1
)+
theme_grafs()
)
new.function <- function (data, scales, width = NULL, na.rm = FALSE, coef = 1.5) {
qs <- c(0.1, 0.25, 0.5, 0.75, 0.9)
if (!is.null(data$weight)) {
mod <- quantreg::rq(y ~ 1, weights = weight, data = data,
tau = qs)
stats <- as.numeric(stats::coef(mod))
}
else {
stats <- as.numeric(stats::quantile(data$y, qs))
}
names(stats) <- c("ymin", "lower", "middle", "upper", "ymax")
iqr <- diff(stats[c(2, 4)])
outliers <- data$y < (stats[2] - coef * iqr) | data$y > (stats[4] +
coef * iqr)
if (any(outliers)) {
stats[c(1, 5)] <- range(c(stats[2:4], data$y[!outliers]),
na.rm = TRUE)
}
if (length(unique(data$x)) > 1)
width <- diff(range(data$x)) * 0.9
df <- as.data.frame(as.list(stats))
df$outliers <- list(data$y[outliers])
if (is.null(data$weight)) {
n <- sum(!is.na(data$y))
}
else {
n <- sum(data$weight[!is.na(data$y) & !is.na(data$weight)])
}
df$notchupper <- df$middle + 1.58 * iqr/sqrt(n)
df$notchlower <- df$middle - 1.58 * iqr/sqrt(n)
df$x <- if (is.factor(data$x))
data$x[1]
else mean(range(data$x))
df$width <- width
df$relvarwidth <- sqrt(n)
df
}
environment(StatBoxplot$compute_group)$f <- new.function
(od <- plan_wide_19902020 %>%
ggplot(
aes(
x = CODIGO,
y = Oxigenio_dissolvido,
group = CODIGO
# color = periodo,
# fill = periodo
)
)+
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = -Inf, ymax = 2,
alpha = 1,
fill = "#ac5079")+ #>pior classe
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = 2, ymax = 4,
alpha = 1,
fill = "#eb5661")+ #classe 4
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = 4, ymax = 5,
alpha = 1,
fill = "#fcf7ab")+ #classe 3
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = 5, ymax = 6,
alpha = 1,
fill = "#70c18c")+ #classe 2
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin= 6, ymax = Inf,
alpha = 1,
fill = "#8dcdeb")+ #classe 1
# stat_summary(
#   aes(),
#   fun
# )
stat_boxplot(
geom = 'errorbar',
width = 0.3,
position = position_dodge(width = 0.65)
)+
# stat_summary(
#   fun.data = f,
#   geom = "boxplot",
#   fill = '#F8F8FF',
#   width = 0.7
# )+
geom_boxplot(
fill = '#F8F8FF',
color = "black",
outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
width = 0.7
)+
facet_wrap(~periodo)+
labs(
title = "Oxigênio Dissolvido no período 1990-2020",
x= NULL,
y="mg/L"
)+
ggbeeswarm::geom_quasirandom(
size = 1.2,
alpha = .25,
width = .07,
)+
scale_y_continuous(
expand = expansion(mult = c(0,0)),
n.breaks = 11,
limits = c(-0.3,21)
)+
scale_x_discrete(limits = c("87398500",
"87398980",
"87398900",
"87398950",
"87405500",
"87406900",
"87409900"),
labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
)+
# scale_fill_brewer(palette = "Set1")+
scale_color_manual(name = "Período",
breaks = c("p1", "p2", "p3"),
values = c("black", "#303030", "#696969"),
labels = c("1990-2000", "2000-2010", "2010-2020")
)+
geom_smooth(
method = "lm",
se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
aes(group = 1),
alpha = .5,
na.rm = TRUE,
size = 1
)+
theme_grafs()
)
compute_group = function(data, scales, width = NULL, na.rm = FALSE, coef = 1.5, flipped_aes = FALSE) {
data <- flip_data(data, flipped_aes)
qs <- c(0, 0.25, 0.5, 0.75, 1)
if (!is.null(data$weight)) {
mod <- quantreg::rq(y ~ 1, weights = weight, data = data, tau = qs)
stats <- as.numeric(stats::coef(mod))
} else {
stats <- as.numeric(stats::quantile(data$y, qs))
}
names(stats) <- c("ymin", "lower", "middle", "upper", "ymax")
iqr <- diff(stats[c(2, 4)])
outliers <- data$y < (stats[2] - coef * iqr) | data$y > (stats[4] + coef * iqr)
if (any(outliers)) {
stats[c(1, 5)] <- range(c(stats[2:4], data$y[!outliers]), na.rm = TRUE)
}
if (length(unique(data$x)) > 1)
width <- diff(range(data$x)) * 0.9
df <- new_data_frame(as.list(stats))
df$outliers <- list(data$y[outliers])
if (is.null(data$weight)) {
n <- sum(!is.na(data$y))
} else {
# Sum up weights for non-NA positions of y and weight
n <- sum(data$weight[!is.na(data$y) & !is.na(data$weight)])
}
df$notchupper <- df$middle + 1.58 * iqr / sqrt(n)
df$notchlower <- df$middle - 1.58 * iqr / sqrt(n)
df$x <- if (is.factor(data$x)) data$x[1] else mean(range(data$x))
df$width <- width
df$relvarwidth <- sqrt(n)
df$flipped_aes <- flipped_aes
flip_data(df, flipped_aes)
}
