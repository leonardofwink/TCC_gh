delim = "\t",
escape_double = FALSE,
col_types = cols(
Alcalinidade = col_double(),
CODIGO = col_character(),
COORD_GEO_LAT_GRAU = col_double(),
COORD_GEO_LONG_GRAU = col_double(),
DATA_COLETA = col_date(format = "%d/%m/%Y"),
Nitrato = col_double(),
Nitrito = col_double(),
SDT = col_double(),
SST = col_double(),
`Vazao` = col_double(),
`Vazao rio` = col_double()
),
locale = locale(
date_names = "pt",
decimal_mark = ",",
grouping_mark = ""
),
trim_ws = TRUE
) %>%
rename(
E_coli = `Escherichia coli`,
fosfato_orto = `Fosfato orto`,
fosforo_total = `Fósforo total`,
nitro_organico = `Nitrogênio orgânico`,
nitro_amon = `Nitrogênio amoniacal`,
nitro_kjeldahl = `Nitrogênio Kjeldahl`,
nitro_total = `Nitrogênio total`,
oxigenio_dissolvido = `Oxigênio dissolvido`,
sat_OD = `%sat OD`,
temp_agua = `Temperatura água`,
temp_ar = `Temperatura ar`,
transparencia_agua = `Transparência água`,
vazao_rio = `Vazao rio`,
coliformes_termo = `Coliformes termotol`,
turbidez = Turbidez,
solidos_totais = `Sólidos totais`,
)
glimpse(plan_wide_19902020)
# Como há dados faltantes, no cálculo entre o produto das colunas, ele acaba interpretando como se fosse zero, mas na verdade é NA
plan_wide_19902020 <- plan_wide_19902020 %>%
mutate(IQA = ifelse(IQA == 0, NA, IQA))
parametros_IQA <- plan_wide_19902020 %>%
select(CODIGO,
pH,
DBO,
E_coli,
nitro_amon,
nitro_kjeldahl,
nitro_total,
fosforo_total,
temp_agua,
turbidez,
solidos_totais,
oxigenio_dissolvido,
Condutividade)
write.csv(parametros_IQA,
"./parametros_IQA.csv",
row.names = FALSE)
plan_wide_19902020 %>%
select(starts_with("IQA_^")) %>%
mutate(
TESTANDOIQA = prod()
)
parametros_IQA[-1]
(od <- plan_wide_19902020 %>%
ggplot(
aes(
x = CODIGO,
y = oxigenio_dissolvido,
# color = periodo,
# fill = periodo
)
)+
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = -Inf, ymax = 2,
alpha = 1,
fill = "#ac5079")+ #>pior classe
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = 2, ymax = 4,
alpha = 1,
fill = "#eb5661")+ #classe 4
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = 4, ymax = 5,
alpha = 1,
fill = "#fcf7ab")+ #classe 3
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = 5, ymax = 6,
alpha = 1,
fill = "#70c18c")+ #classe 2
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin= 6, ymax = Inf,
alpha = 1,
fill = "#8dcdeb")+ #classe 1
stat_boxplot(
geom = 'errorbar',
width = 0.3,
position = position_dodge(width = 0.65)
)+
geom_boxplot(
fill = '#F8F8FF',
color = "black",
outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
width = 0.7
)+
facet_wrap(~periodo)+
labs(
title = "Oxigênio Dissolvido no período 1990-2020",
x= NULL,
y="mg/L"
)+
ggbeeswarm::geom_quasirandom(
size = 1.2,
alpha = .25,
width = .07,
)+
scale_y_continuous(
expand = expansion(mult = c(0,0)),
n.breaks = 11,
limits = c(-0.3,21)
)+
scale_x_discrete(limits = c("87398500",
"87398980",
"87398900",
"87398950",
"87405500",
"87406900",
"87409900"),
labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
)+
# scale_fill_brewer(palette = "Set1")+
scale_color_manual(name = "Período",
breaks = c("p1", "p2", "p3"),
values = c("black", "#303030", "#696969"),
labels = c("1990-2000", "2000-2010", "2010-2020")
)+
geom_smooth(
method = "lm",
se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
aes(group = 1),
alpha = .5,
na.rm = TRUE,
size = 1
)+
theme_grafs()
)
plan_wide_19902020 <- plan_wide_19902020 %>%
# select(CODIGO, ANO_COLETA) %>%
mutate(
periodo = if_else(
ANO_COLETA <= 2000,
"1990-2000",
if_else(
ANO_COLETA <= 2010,
"2000-2010",
"2010-2020"
)
)
)
theme_grafs <- function(bg = "white",
coloracao_letra = "black") {
theme(
plot.title =
element_text(
hjust = 0.5,
color = coloracao_letra,
size = 19),
axis.title.x =
# element_text(
# color = coloracao_letra,
# size = 15,
# angle = 0,),
element_blank(),
axis.title.y = element_text(
color = coloracao_letra,
size = 15,
angle = 90),
axis.text.x = element_text(
color = coloracao_letra,
size = 17),
axis.text.y = element_text(
color = coloracao_letra,
size = 17,
angle = 0),
strip.background = element_rect(fill = bg,
linetype = 1,
size = 0.5,
color = "black"),
strip.text = element_text(size = 17),
panel.background = element_rect(fill = bg),
plot.background = element_rect(fill = bg),
plot.margin = margin(l = 5, r = 10,
b = 5, t = 5)
)
}
# plan_wide_19902020 %>%
#   as_tibble() %>%
#   filter(ANO_COLETA > "1990" &
#            ANO_COLETA <= "2000") %>%
#   select(colnames(parametros_IQA)) %>%
#   group_by(CODIGO) %>%
#   group_by(colnames(parametros_IQA)) %>%
#   summarise_each(
#     funs(
#       min =
#         min(.,
#             na.rm = TRUE),
#       q1 =
#         quantile(., 0.25,
#                  na.rm = TRUE),
#       median =
#         median(.,
#                na.rm = TRUE),
#       mean =
#         mean(.,
#              na.rm= TRUE),
#       q3 =
#         quantile(., 0.75,
#                  na.rm = TRUE),
#       max =
#         max(.,
#             na.rm = TRUE),
#       n =
#         length(.)
#     )
#   ) %>%
#   pivot_longer(
#        !CODIGO,
#        names_to = "parametro",
#        values_to = "valor"
#     ) %>%
#     pivot_wider(names_from = CODIGO,
#                 values_from = valor) %>%
#   group_by(parametro)
# p2 <- plan_wide_19902020 %>%
#   filter(ANO_COLETA > "2000" &
#          ANO_COLETA <= "2010")
#
# p3 <- plan_wide_19902020 %>%
#   filter(ANO_COLETA > "2010" &
#          ANO_COLETA <= "2020")
# periodo = c(p1 <- plan_wide_19902020 %>%
#   filter(ANO_COLETA > "1990" &
#            ANO_COLETA <= "2000"),
#
# p2 <- plan_wide_19902020 %>%
#   filter(ANO_COLETA > "2000" &
#            ANO_COLETA <= "2010"),
#
# p3 <- plan_wide_19902020 %>%
#   filter(ANO_COLETA > "2010" &
#            ANO_COLETA <= "2020"))
# sumario <- function(parametros = parametros, periodo){
#   plan_wide_19902020 %>%
#    select(CODIGO, ., ANO_COLETA) %>%
#    # filter(ANO_COLETA>"1990" &
#    #          ANO_COLETA<="2000") %>%
#    group_by(CODIGO) %>%
#    summarize(
#      min =
#        min(parametros,
#            na.rm = TRUE),
#      q1 =
#        quantile(parametros, 0.25,
#                 na.rm = TRUE),
#      median =
#        median(parametros,
#               na.rm = TRUE),
#      mean =
#        mean(parametros,
#             na.rm= TRUE),
#      q3 =
#        quantile(parametros, 0.75,
#                 na.rm = TRUE),
#      max =
#        max(parametros,
#            na.rm = TRUE))
# }
# plan_wide_19902020 %>%
#   sumario(parametros = DBO)
# sum_IQA_p1 <- plan_wide_19902020 %>%
#    select(CODIGO, IQA, ANO_COLETA) %>%
#    filter(ANO_COLETA>"1990" &
#             ANO_COLETA<="2000") %>%
#    group_by(CODIGO) %>%
#    summarize(
#      min =
#        min(IQA,
#            na.rm = TRUE),
#      q1 =
#        quantile(IQA, 0.25,
#                 na.rm = TRUE),
#      median =
#        median(IQA,
#               na.rm = TRUE),
#      mean =
#        mean(IQA,
#             na.rm= TRUE),
#      q3 =
#        quantile(IQA, 0.75,
#                 na.rm = TRUE),
#      max =
#        max(IQA,
#            na.rm = TRUE))
(od <- plan_wide_19902020 %>%
ggplot(
aes(
x = CODIGO,
y = oxigenio_dissolvido,
# color = periodo,
# fill = periodo
)
)+
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = -Inf, ymax = 2,
alpha = 1,
fill = "#ac5079")+ #>pior classe
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = 2, ymax = 4,
alpha = 1,
fill = "#eb5661")+ #classe 4
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = 4, ymax = 5,
alpha = 1,
fill = "#fcf7ab")+ #classe 3
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin = 5, ymax = 6,
alpha = 1,
fill = "#70c18c")+ #classe 2
annotate("rect",
xmin = -Inf, xmax = Inf,
ymin= 6, ymax = Inf,
alpha = 1,
fill = "#8dcdeb")+ #classe 1
stat_boxplot(
geom = 'errorbar',
width = 0.3,
position = position_dodge(width = 0.65)
)+
geom_boxplot(
fill = '#F8F8FF',
color = "black",
outlier.shape = NA, #se deixar NA fica só o jitter, se não, deixa 1
width = 0.7
)+
facet_wrap(~periodo)+
labs(
title = "Oxigênio Dissolvido no período 1990-2020",
x= NULL,
y="mg/L"
)+
ggbeeswarm::geom_quasirandom(
size = 1.2,
alpha = .25,
width = .07,
)+
scale_y_continuous(
expand = expansion(mult = c(0,0)),
n.breaks = 11,
limits = c(-0.3,21)
)+
scale_x_discrete(limits = c("87398500",
"87398980",
"87398900",
"87398950",
"87405500",
"87406900",
"87409900"),
labels = c("PM1", "PM2", "PM3", "PM4", "PM5", "PM6", "PM7")
)+
# scale_fill_brewer(palette = "Set1")+
scale_color_manual(name = "Período",
breaks = c("p1", "p2", "p3"),
values = c("black", "#303030", "#696969"),
labels = c("1990-2000", "2000-2010", "2010-2020")
)+
geom_smooth(
method = "lm",
se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
aes(group = 1),
alpha = .5,
na.rm = TRUE,
size = 1
)+
theme_grafs()
)
library(performance)
modelo <-
plan_wide_19902020 %>%
select(CODIGO, oxigenio_dissolvido) %>%
lm()
modelo
modelo <-
plan_wide_19902020 %>%
select(CODIGO, oxigenio_dissolvido) %>%
group_by(CODIGO)
modelo <-
plan_wide_19902020 %>%
select(CODIGO, oxigenio_dissolvido) %>%
group_by(CODIGO) %>%
lm()
modelo
modelo <-
plan_wide_19902020 %>%
select(CODIGO, oxigenio_dissolvido, periodo) %>%
group_by(CODIGO) %>%
lm()
plan_wide_19902020 %>%
select(CODIGO, oxigenio_dissolvido, periodo) %>%
group_by(CODIGO, periodo
plan_wide_19902020 %>%
select(CODIGO, oxigenio_dissolvido, periodo) %>%
group_by(CODIGO, periodo)
plan_wide_19902020 %>%
select(CODIGO, oxigenio_dissolvido, periodo) %>%
group_by(CODIGO, periodo) %>%
lm()
plan_wide_19902020 %>%
select(CODIGO, oxigenio_dissolvido, periodo) %>%
group_by(CODIGO, periodo)
plan_wide_19902020 %>%
select(CODIGO, oxigenio_dissolvido, periodo) %>%
group_by(CODIGO, periodo) %>%
lm()
modelo <- plan_wide_19902020 %>%
select(CODIGO, oxigenio_dissolvido, periodo) %>%
group_by(CODIGO, periodo) %>%
lm()
check_model(modelo)
performance::check_autocorrelation(modelo)
?check_autocorrelation
modelo <- plan_wide_19902020 %>%
select(CODIGO, oxigenio_dissolvido, periodo) %>%
group_by(CODIGO, periodo) %>%
performance::check_autocorrelation(modelo)
modelo <- plan_wide_19902020 %>%
select(CODIGO, oxigenio_dissolvido, periodo) %>%
group_by(CODIGO, periodo) %>%
performance::check_autocorrelation()
performance::check_autocorrelation(modelo)
modelo <- plan_wide_19902020 %>%
select(CODIGO, oxigenio_dissolvido, periodo) %>%
group_by(CODIGO, periodo) %>%
lm() %>%
performance::check_distribution()
parametros_IQA
parametros_IQA %>%
select(-CODIGO) %>%
ggcorr(
method = "complete.obs",
# "pearson",
# "pairwise",
name = "Correlação",
label = TRUE,
label_alpha = TRUE,
digits = 3,
low = "#3B9AB2",
mid = "#EEEEEE",
high = "#F21A00",
# palette = "RdYlBu",
layout.exp = 0,
legend.position = "left",
label_round = 3,
)
#       #                               "Classe 2"="#70c18c",
#       #                               "Classe 3"="#fcf7ab",
#       #                               "Classe 4"="#eb5661",
#       #                               "Pior Classe"="#ac5079"))+
#    # guides(color=guide_legend(override.aes = list(linetype=c(1,1,1,1,1),
#    #                                               lwd=c(2,2,2,2,2),
#    #                                               shape=c(NA,NA,NA,NA,NA),
#    #                                               alpha=1)))+
#       theme(legend.position = "bottom")+
#       theme_classic())
read_html(x = "https://homicides.news.baltimoresun.com/recent/") %>%
html_node(
# html,
".recentvictims"
) %>%
html_children() %>%
head() %>%
html_text2()
#       #                               "Classe 2"="#70c18c",
#       #                               "Classe 3"="#fcf7ab",
#       #                               "Classe 4"="#eb5661",
#       #                               "Pior Classe"="#ac5079"))+
#    # guides(color=guide_legend(override.aes = list(linetype=c(1,1,1,1,1),
#    #                                               lwd=c(2,2,2,2,2),
#    #                                               shape=c(NA,NA,NA,NA,NA),
#    #                                               alpha=1)))+
#       theme(legend.position = "bottom")+
#       theme_classic())
pacman::p_load(rvest)
read_html(x = "https://homicides.news.baltimoresun.com/recent/") %>%
html_node(
# html,
".recentvictims"
) %>%
html_children() %>%
head() %>%
html_text2()
