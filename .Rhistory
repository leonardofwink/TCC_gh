)
(sum_SolTot_p3 <- plan_wide_19902020 %>%
select(CODIGO, `Sólidos totais`, ANO_COLETA) %>%
filter(ANO_COLETA>"2010" &
ANO_COLETA<="2020") %>%
group_by(CODIGO) %>%
summarize(
min =
min(`Sólidos totais`,
na.rm = TRUE),
q1 =
quantile(`Sólidos totais`, 0.25,
na.rm = TRUE),
median =
median(`Sólidos totais`,
na.rm = TRUE),
mean =
mean(`Sólidos totais`,
na.rm= TRUE),
q3 =
quantile(`Sólidos totais`, 0.75,
na.rm = TRUE),
max =
max(`Sólidos totais`,
na.rm = TRUE))
)
# Chunk 60: Gráfico IQA periodo1
plan_wide_19902020 <- plan_wide_19902020 %>%
mutate(IQA = ifelse(IQA == 0, NA, IQA))
(iqa_p1 <-ggplot(plan_wide_19902020 %>%
filter(ANO_COLETA > "1990" &
ANO_COLETA <= "2000"),
aes(CODIGO,
IQA, na.rm = TRUE))+
annotate("rect",
xmin=-Inf,
xmax=Inf,
ymin=-Inf,
ymax=19,
alpha=1,
fill="#ac5079")+ #>pior classe
annotate("rect",
xmin=-Inf,
xmax=Inf,
ymin=19,
ymax=36,
alpha=1,
fill="#eb5661")+ #classe 4
annotate("rect",
xmin=-Inf,
xmax=Inf,
ymin=36,
ymax=51,
alpha=1,
fill="#fcf7ab")+ #classe 3
annotate("rect",
xmin=-Inf,
xmax=Inf,
ymin=51,
ymax=79,
alpha=1,
fill="#70c18c")+ #classe 2
annotate("rect",
xmin=-Inf,
xmax=Inf,
ymin=79,
ymax=Inf,
alpha=1,
fill="#8dcdeb")+ #classe 1
stat_boxplot(geom = 'errorbar',
width=0.3,
position = position_dodge(width = 0.65),
na.rm = TRUE)+
geom_boxplot(fill='#F8F8FF',
color="black",
outlier.shape = 1, #se deixar NA fica só o jitter, se não, deixa 1
width= 0.7,
na.rm = TRUE)+
labs(title = "Variação do IQA no período 1990-2000",
x="Estação",
y="")+
# geom_jitter(width = .05,
#             alpha=.2,
#             size=1.5,
#             color="black")+
scale_y_continuous(expand = expansion(mult = c(0,0)),
n.breaks = 6,
limits = c(-1,101))+
scale_x_discrete(limits = c("87398500", "87398980", "87398900", "87398950", "87405500", "87406900", "87409900"))+
geom_smooth(method = "lm",
se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
aes(group=1),
alpha=.5,
na.rm = TRUE,
size = 1)+
# geom_line(aes(color="red"),
#           alpha=.0)+
# scale_color_manual("Legenda",
#                    guide="legend",
#                    values = c("Ótima"="#8dcdeb",
#                               "Boa"="#70c18c",
#                               "Regular"="#fcf7ab",
#                               "Ruim"="#eb5661",
#                               "Péssima"="#ac5079"))+
# guides(color=guide_legend(override.aes = list(linetype=c(1,1,1,1,1),
#                                               lwd=c(2,2,2,2,2),
#                                               shape=c(NA,NA,NA,NA,NA),
#                                               alpha=1)))+
theme(legend.position = "bottom")+
theme_classic())
# Chunk 61: Gráfico IQA periodo2
(iqa_p2 <-ggplot(plan_wide_19902020 %>%
filter(ANO_COLETA > "2000" &
ANO_COLETA <= "2010"),
aes(CODIGO,
IQA, na.rm = TRUE))+
annotate("rect",
xmin=-Inf,
xmax=Inf,
ymin=-Inf,
ymax=19,
alpha=1,
fill="#ac5079")+ #>pior classe
annotate("rect",
xmin=-Inf,
xmax=Inf,
ymin=19,
ymax=36,
alpha=1,
fill="#eb5661")+ #classe 4
annotate("rect",
xmin=-Inf,
xmax=Inf,
ymin=36,
ymax=51,
alpha=1,
fill="#fcf7ab")+ #classe 3
annotate("rect",
xmin=-Inf,
xmax=Inf,
ymin=51,
ymax=79,
alpha=1,
fill="#70c18c")+ #classe 2
annotate("rect",
xmin=-Inf,
xmax=Inf,
ymin=79,
ymax=Inf,
alpha=1,
fill="#8dcdeb")+ #classe 1
stat_boxplot(geom = 'errorbar',
width=0.3,
position = position_dodge(width = 0.65),
na.rm = TRUE)+
geom_boxplot(fill='#F8F8FF',
color="black",
outlier.shape = 1, #se deixar NA fica só o jitter, se não, deixa 1
width= 0.7,
na.rm = TRUE)+
labs(title = "Variação do IQA no período 2000-2010",
x="Estação",
y="")+
# geom_jitter(width = .05,
#             alpha=.2,
#             size=1.5,
#             color="black")+
scale_y_continuous(expand = expansion(mult = c(0,0)),
n.breaks = 6,
limits = c(-1,101))+
scale_x_discrete(limits = c("87398500", "87398980", "87398900", "87398950", "87405500", "87406900", "87409900"))+
geom_smooth(method = "lm",
se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
aes(group=1),
alpha=.5,
na.rm = TRUE,
size = 1)+
# geom_line(aes(color="red"),
#           alpha=.0)+
# scale_color_manual("Legenda",
#                    guide="legend",
#                    values = c("Ótima"="#8dcdeb",
#                               "Boa"="#70c18c",
#                               "Regular"="#fcf7ab",
#                               "Ruim"="#eb5661",
#                               "Péssima"="#ac5079"))+
# guides(color=guide_legend(override.aes = list(linetype=c(1,1,1,1,1),
#                                               lwd=c(2,2,2,2,2),
#                                               shape=c(NA,NA,NA,NA,NA),
#                                               alpha=1)))+
theme(legend.position = "bottom")+
theme_classic())
# Chunk 62: Gráfico IQA periodo3
(iqa_p3 <-ggplot(plan_wide_19902020 %>%
filter(ANO_COLETA > "2010" &
ANO_COLETA <= "2020"),
aes(CODIGO,
IQA, na.rm = TRUE))+
annotate("rect",
xmin=-Inf,
xmax=Inf,
ymin=-Inf,
ymax=19,
alpha=1,
fill="#ac5079")+ #>pior classe
annotate("rect",
xmin=-Inf,
xmax=Inf,
ymin=19,
ymax=36,
alpha=1,
fill="#eb5661")+ #classe 4
annotate("rect",
xmin=-Inf,
xmax=Inf,
ymin=36,
ymax=51,
alpha=1,
fill="#fcf7ab")+ #classe 3
annotate("rect",
xmin=-Inf,
xmax=Inf,
ymin=51,
ymax=79,
alpha=1,
fill="#70c18c")+ #classe 2
annotate("rect",
xmin=-Inf,
xmax=Inf,
ymin=79,
ymax=Inf,
alpha=1,
fill="#8dcdeb")+ #classe 1
stat_boxplot(geom = 'errorbar',
width=0.3,
position = position_dodge(width = 0.65),
na.rm = TRUE)+
geom_boxplot(fill='#F8F8FF',
color="black",
outlier.shape = 1, #se deixar NA fica só o jitter, se não, deixa 1
width= 0.7,
na.rm = TRUE)+
labs(title = "Variação do IQA no período 2010-2020",
x="Estação",
y="")+
# geom_jitter(width = .05,
#             alpha=.2,
#             size=1.5,
#             color="black")+
scale_y_continuous(expand = expansion(mult = c(0,0)),
n.breaks = 6,
limits = c(-1,101))+
scale_x_discrete(limits = c("87398500", "87398980", "87398900", "87398950", "87405500", "87406900", "87409900"))+
geom_smooth(method = "lm",
se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
aes(group=1),
alpha=.5,
na.rm = TRUE,
size = 1)+
# geom_line(aes(color="red"),
#           alpha=.0)+
# scale_color_manual("Legenda",
#                    guide="legend",
#                    values = c("Ótima"="#8dcdeb",
#                               "Boa"="#70c18c",
#                               "Regular"="#fcf7ab",
#                               "Ruim"="#eb5661",
#                               "Péssima"="#ac5079"))+
# guides(color=guide_legend(override.aes = list(linetype=c(1,1,1,1,1),
#                                               lwd=c(2,2,2,2,2),
#                                               shape=c(NA,NA,NA,NA,NA),
#                                               alpha=1)))+
theme(legend.position = "bottom")+
theme_classic())
# Chunk 63: Gráfico IQA 3 periodos juntos
grid.arrange(iqa_p1, iqa_p2, iqa_p3, ncol = 3)
# grid.arrange(dbo_p1, dbo_p2, dbo_p3,
#              iqa_dbo1, iqa_dbo2, iqa_dbo3,
#              ncol = 3, nrow=2)
# Chunk 64: Sumário IQA
(sum_IQA_p1 <- plan_wide_19902020 %>%
select(CODIGO, IQA, ANO_COLETA) %>%
filter(ANO_COLETA>"1990" &
ANO_COLETA<="2000") %>%
group_by(CODIGO) %>%
summarize(
min =
min(IQA,
na.rm = TRUE),
q1 =
quantile(IQA, 0.25,
na.rm = TRUE),
median =
median(IQA,
na.rm = TRUE),
mean =
mean(IQA,
na.rm= TRUE),
q3 =
quantile(IQA, 0.75,
na.rm = TRUE),
max =
max(IQA,
na.rm = TRUE))
)
(sum_IQA_p2 <- plan_wide_19902020 %>%
select(CODIGO, IQA, ANO_COLETA) %>%
filter(ANO_COLETA>"2000" &
ANO_COLETA<="2010") %>%
group_by(CODIGO) %>%
summarize(
min =
min(IQA,
na.rm = TRUE),
q1 =
quantile(IQA, 0.25,
na.rm = TRUE),
median =
median(IQA,
na.rm = TRUE),
mean =
mean(IQA,
na.rm= TRUE),
q3 =
quantile(IQA, 0.75,
na.rm = TRUE),
max =
max(IQA,
na.rm = TRUE))
)
(sum_IQA_p3 <- plan_wide_19902020 %>%
select(CODIGO, IQA, ANO_COLETA) %>%
filter(ANO_COLETA>"2010" &
ANO_COLETA<="2020") %>%
group_by(CODIGO) %>%
summarize(
min =
min(IQA,
na.rm = TRUE),
q1 =
quantile(IQA, 0.25,
na.rm = TRUE),
median =
median(IQA,
na.rm = TRUE),
mean =
mean(IQA,
na.rm= TRUE),
q3 =
quantile(IQA, 0.75,
na.rm = TRUE),
max =
max(IQA,
na.rm = TRUE),
n =
length(IQA))
)
plan_wide_19902020 %>%
select(CODIGO, IQA) %>%
group_by(CODIGO) %>%
summarize(
min =
min(IQA,
na.rm = TRUE),
q1 =
quantile(IQA, 0.25,
na.rm = TRUE),
median =
median(IQA,
na.rm = TRUE),
mean =
mean(IQA,
na.rm= TRUE),
q3 =
quantile(IQA, 0.75,
na.rm = TRUE),
max =
max(IQA,
na.rm = TRUE))
# Chunk 65: Testando coisas
# ggplot(mtcars, aes(x=hp, y=wt)) +
#   geom_point() +
#   geom_smooth()
#
# iris %>%
#   qplot(Sepal.Length, Sepal.Width,
#         colour = Species, fill=Species, data=.) +
#   geom_smooth(method=lm)
#
#
# df111 <- data.frame(x = c(1:100))
# glimpse(df111)
# df111$y <- 2 + 3 * df111$x + rnorm(100, sd = 40)
# p111 <- ggplot(data = df111, aes(x = x, y = y)) +
#             geom_smooth(method = "lm", se=FALSE, color="black", formula = y ~ x) +
#             geom_point()
# p111
#
# lm_eqn <- function(df111){
#     m <- lm(y ~ x, df111);
#     eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2,
#          list(a = format(unname(coef(m)[1]), digits = 2),
#               b = format(unname(coef(m)[2]), digits = 2),
#              r2 = format(summary(m)$r.squared, digits = 3)))
#     as.character(as.expression(eq));
# }
#
# p2 <- p111 +
#   geom_text(x = 25, y = 300,
#             label = lm_eqn(df111),
#             parse = TRUE)
# install.packages("ggpmisc")
# library(ggpmisc)
# summary(lm(plan_wide_19902020$CODIGO~plan_wide_19902020$DBO))
#
#
# p <- ggplot(data, aes(y=number, x=pod)) +
#   geom_boxplot()
# print(p)
# install.packages("GGally")
fit = lm(plan_wide_19902020$`Oxigênio dissolvido`~ plan_wide_19902020$CODIGO)
summary(fit)
summary.lm(fit)
plan_wide_19902020$IQA
plan_wide_19902020 <- plan_wide_19902020 %>%
mutate(IQA = ifelse(IQA == 0, NA, IQA))
# Chunk 66: Correlação
library(GGally)
parametros_IQA <- plan_wide_19902020 %>%
select(CODIGO,
`Escherichia coli`,
pH,
DBO,
`Nitrogênio amoniacal`,
`Nitrogênio total`,
`Fósforo total`,
`Temperatura água`,
Turbidez,
`Sólidos totais`,
`Oxigênio dissolvido`,
Condutividade)
parametros_IQA %>%
select(-`Nitrogênio amoniacal`, -CODIGO) %>%
ggcorr(method = "complete.obs",
label = TRUE,
label_alpha = TRUE)
# Chunk 67: Gráfico CondElet periodo1
(Cond_elet_p1 <- ggplot(plan_wide_19902020 %>%
filter(ANO_COLETA>"1990" &
ANO_COLETA<="2000"),
aes(CODIGO,
Condutividade))+
annotate("rect",
xmin=-Inf,
xmax=Inf,
ymin=500,
ymax=Inf,
alpha=1,
fill="#eb5661")+ #classe 4
annotate("rect",
xmin=-Inf,
xmax=Inf,
ymin=-Inf,
ymax=500,
alpha=1,
fill="#8dcdeb")+ #classe 1
stat_boxplot(geom = 'errorbar',
width=0.3,
position = position_dodge(width = 0.65))+
geom_boxplot(fill='#F8F8FF',
color="black",
outlier.shape = 1, #se deixar NA fica só o jitter, se não, deixa 1
width= 0.7)+
labs(title = "Condutividade elétrica no período 1990-2000",
x="Estação",
y="")+
# geom_jitter(width = .05,
#             alpha=.2,
#             size=1.5,
#             color="black")+
scale_y_continuous(expand = expansion(mult = c(0.01, 0.05)),
n.breaks = 8,
limits = c(0,
max(plan_wide_19902020$Condutividade, na.rm = TRUE)),
labels = scales::number_format(accuracy = 1,
decimal.mark = ",",
big.mark = " "))+
scale_x_discrete(limits = c("87398500", "87398980", "87398900", "87398950", "87405500", "87406900", "87409900"))+
geom_smooth(method = "lm",
se=FALSE, #se deixar TRUE gera o intervalo de confiança de 95%
aes(group=1),
alpha=.5,
na.rm = TRUE,
size = 1)+
# geom_line(aes(color="red"),
#           alpha=.0)+
# scale_color_manual("Legenda",
#                    guide="legend",
#                    values = c("Pior Classe"="#ac5079",
#                               "Classe 3"="#fcf7ab",
#                               "Classe 1"="#8dcdeb"))+
# guides(color=guide_legend(override.aes = list(linetype=c(1,1,1),
#                                               lwd=c(2,2,2),
#                                               shape=c(NA,NA,NA),
#                                               alpha=1)))+
theme_classic())
# Chunk 68: Salvando os gráficos
# ggsave("od_p1.png",
#        plot = od_p1,
#        width = 13,
#        height = 10,
#        dpi = 300)
